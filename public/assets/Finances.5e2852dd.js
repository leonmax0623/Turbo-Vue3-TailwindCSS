import{V as e,o as a,f as t,J as l,e as s,t as o,j as r,l as d,u as n,r as i,w as u,L as p,M as c,ag as m,a6 as f,a1 as v,d as b,a8 as y,$ as _,aW as j,X as g,W as x,h,n as w}from"./vendor.36c281f3.js";import{_ as k}from"./Office.55bfbecd.js";import{_ as V}from"./Header.5847de72.js";import{_ as C}from"./Button.4b020695.js";import{_ as B}from"./ButtonGroup.f61666b1.js";import{_ as F}from"./Select.bf4a4e1e.js";import{_ as O}from"./Input.b03a61c6.js";import{_ as U}from"./Label.f0bc0125.js";import{u as $}from"./useSuspense.29183c13.js";import{_ as D}from"./Badge.4bd69676.js";import{_ as E}from"./Link.4e9a6f0f.js";import{f as I,s as M,_ as S,a as A}from"./Pay.968f65cd.js";import{$ as L}from"./drop.cce90c26.js";import{u as T}from"./useConfirmDialog.ba73d887.js";import{_ as W}from"./Table.ec42ea9a.js";import{g as G,l as P,a as H,o as J}from"./useAvatar.7737e550.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./departments.4f88a00d.js";import"./index.8fc70fb6.js";import"./meta.48f5205a.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./Spinner.2e0ab286.js";import"./useModalForm.1c23c14e.js";import"./FormActions.47218f8a.js";import"./groups.5d62c0cb.js";import"./orders.a1ebe807.js";import"./useOrder.941ce970.js";import"./Dialog.b36041f9.js";import"./Th.32cd08d3.js";import"./useIntersectionObserver.7ad3d6a4.js";const N={class:"font-bold"},R={class:"font-bold"},X={class:"font-bold"},q={async setup(i){let u,p;const{render:c,typesMapper:m,finance_color_map:f}=I(),{fetchFinances:v}=M(),{state:b,drop:y,updateStatus:_}=A,{drop:j}=T(),g=[{label:"Название",key:"name"},{label:"Заказ-наряд",key:"order"},{label:"Сумма (₽)",key:"sum"},{label:"Оплаченная сумма (₽)",key:"paid_sum"},{label:"Тип операции",key:"operation_type"},{label:"Статус",key:"status"},{label:"Дата создания",key:"created_at"}];[u,p]=e((()=>(async()=>{const{success:e,operation_types:a,payment_types:t}=await L({key:"finances/types"});e&&(m.value={operations:a,payments:t})})())),u=await u,p(),[u,p]=e((()=>v(!0))),u=await u,p();const x=async e=>{await e()},h=e=>"buy"==e.operation_type||"buyReturn"==e.operation_type&&("inProgress"==e.status||"ready"==e.status);return(e,i)=>(a(),t(W,{onBottomTouched:i[0]||(i[0]=()=>n(v)()),fields:g,items:n(b).raw,onDelete:i[1]||(i[1]=e=>n(j)((()=>n(y)(e)))),onEdit:i[2]||(i[2]=e=>n(c)(e)),noEdit:h},{"th-sum":l((({label:e})=>[s("span",N,o(e),1)])),"td-name":l((({value:e,item:a})=>[r(E,{disabled:h(a),onClick:()=>n(c)(a.id)},{default:l((()=>[d(o(e),1)])),_:2},1032,["disabled","onClick"])])),"td-order":l((({value:e})=>{var a;return[r(E,{href:{name:"OrderEdit",params:{id:null!=(a=null==e?void 0:e.id)?a:"0"}},disabled:!(null==e?void 0:e.id)},{default:l((()=>[d(o((null==e?void 0:e.id)?`#${n(G)(null==e?void 0:e.id)}`:"_"),1)])),_:2},1032,["href","disabled"])]})),"td-sum":l((({value:e})=>[s("span",R,o(e)+" ₽",1)])),"td-paid_sum":l((({item:{order:e}})=>{var a;return[s("span",X,o(null!=(a=null==e?void 0:e.total_paid_sum)?a:"_")+" ₽",1)]})),"td-operation_type":l((({value:e})=>{var a;return[r(D,{point:!0,color:null==(a=n(P)[n(f)[e]])?void 0:a.color},{default:l((()=>[d(o(n(m).operations[e]),1)])),_:2},1032,["color"])]})),"td-status":l((({value:e,item:{id:a}})=>[r(S,{id:a,status:e,cb:n(_),paymentWrapper:x},null,8,["id","status","cb"])])),"td-created_at":l((({value:e})=>[d(o(null==e?void 0:e.split(" ")[0]),1)])),_:1},8,["items"]))}};p("data-v-b04df9dc");const z=d("Группы "),K=d("Добавить операцию "),Q=d("сводка"),Y={class:"flex justify-start items-center rounded shadow p-4 flex-grow bg-gray-50"},Z=s("h5",{class:"text-gray-500 font-semibold"},"Баланс",-1),ee={class:"font-bold text-lg transactions"},ae={class:"md:mx-6 flex justify-start items-center rounded shadow p-4 flex-grow bg-gray-50"},te=s("h5",{class:"text-gray-500 font-semibold"},"Траты",-1),le={class:"font-bold text-lg transactions"},se={class:"flex justify-start items-center rounded shadow p-4 flex-grow bg-gray-50"},oe=s("h5",{class:"text-gray-500 font-semibold"},"Ожидается",-1),re={class:"font-bold text-lg transactions"},de=d("Фильтр"),ne={class:"flex flex-wrap gap-2 items-start"},ie=d("Статус"),ue={class:"text-center ml-5"},pe=d("сбросить");c();const ce={setup(e){let{render:p,types:c,typesMapper:D,finance_color_map:E,payment_types:S}=I();const{filter:A,order:T,resetFilter:W,cleanUp:G,current:N,state:R}=M(),{criteriaOptions:X}=T,ce=$(q),me=i("");u(A,H((()=>{N.value&&(me.value=J(A))})),{deep:!0});const fe=i({});return u((()=>R.raw.length),H((async()=>{const e=await L({key:"finances/summaries"});fe.value={balance:(null==e?void 0:e.balance)||0,expected:(null==e?void 0:e.expected)||0,expense:(null==e?void 0:e.expense)||0}}))),m((()=>{c=void 0,D=void 0,S=void 0,G()})),(e,i)=>(a(),t(k,{title:"Финансы"},{actions:l((()=>[r(C,{type:"secondary",link:{name:"FinanceGroups"}},{default:l((()=>[r(n(f),{class:"w-5 h-5 mr-1"}),z])),_:1}),r(C,{color:"blue",onClick:i[0]||(i[0]=()=>n(p)())},{default:l((()=>[r(n(v),{class:"w-5 h-5 mr-1"}),K])),_:1})])),default:l((()=>{var e,u,p,m,f,v;return[r(V,null,{default:l((()=>[Q])),_:1}),(a(),b("div",{class:"flex flex-wrap items-stretch",key:n(R).raw.length},[s("div",Y,[s("div",null,[r(n(y),{class:"w-7 h-7 mr-4 text-gray-500"})]),s("div",null,[Z,s("h2",ee,o(null!=(u=null==(e=fe.value)?void 0:e.balance)?u:0)+" ₽",1)])]),s("div",ae,[s("div",null,[r(n(_),{class:"w-7 h-7 mr-4 text-gray-500"})]),s("div",null,[te,s("h2",le,o(null!=(m=null==(p=fe.value)?void 0:p.expense)?m:0)+" ₽",1)])]),s("div",se,[s("div",null,[r(n(j),{class:"w-7 h-7 mr-4 text-gray-500"})]),s("div",null,[oe,s("h2",re,o(null!=(v=null==(f=fe.value)?void 0:f.expected)?v:0)+" ₽",1)])])])),r(V,null,{default:l((()=>[de])),_:1}),s("div",ne,[r(O,{label:"Название",modelValue:n(A).name,"onUpdate:modelValue":i[1]||(i[1]=e=>n(A).name=e)},null,8,["modelValue"]),s("div",null,[r(U,null,{default:l((()=>[ie])),_:1}),r(B,null,{default:l((()=>[(a(!0),b(x,null,g(n(c),((e,s)=>{var r;return a(),t(C,{key:e.value,type:"secondary",class:w(["whitespace-nowrap",n(A).operation_type===e.value?`bg-${null==(r=n(P)[n(E)[e.value]])?void 0:r.color}-100`:""]),group:0===s?"left":s===n(c).length-1?"right":void 0,onClick:a=>n(A).operation_type=e.value},{default:l((()=>[d(o(e.label),1)])),_:2},1032,["class","group","onClick"])})),128))])),_:1})]),r(O,{label:"Дата от",type:"date",modelValue:n(A).start_date,"onUpdate:modelValue":i[2]||(i[2]=e=>n(A).start_date=e)},null,8,["modelValue"]),r(O,{label:"Дата до",type:"date",modelValue:n(A).end_date,"onUpdate:modelValue":i[3]||(i[3]=e=>n(A).end_date=e)},null,8,["modelValue"]),s("div",null,[r(F,{label:"Сортировать",options:n(X),modelValue:n(A).order,"onUpdate:modelValue":i[4]||(i[4]=e=>n(A).order=e),class:"w-44"},null,8,["options","modelValue"])]),s("div",ue,[r(U,null,{default:l((()=>[pe])),_:1}),r(C,{type:"secondary",class:"rounded-full",onClick:i[5]||(i[5]=()=>n(W)())},{default:l((()=>[r(n(_),{class:"h-4 w-4 text-gray-600"})])),_:1})])]),null!=n(N)?(a(),t(n(ce),{key:`${me.value}-${n(N)}`})):h("",!0)]})),_:1}))},__scopeId:"data-v-b04df9dc"};export{ce as default};
