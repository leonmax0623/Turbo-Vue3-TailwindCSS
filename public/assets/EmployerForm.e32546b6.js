var e=Object.defineProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(a,o,r)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[o]=r,s=(e,s)=>{for(var t in s||(s={}))o.call(s,t)&&l(e,t,s[t]);if(a)for(var t of a(s))r.call(s,t)&&l(e,t,s[t]);return e};import{c as t,E as i,F as d,G as n,Q as u,R as m,H as p,I as c,ag as v,V as f,o as b,f as _,J as w,j as g,u as V,av as h,v as y,l as j}from"./vendor.36c281f3.js";import{_ as $}from"./Office.55bfbecd.js";import{_ as U}from"./Button.4b020695.js";import{d as E,c as A,a as q,u as M,b as B}from"./index.8fc70fb6.js";import{r as k,h as F,s as I}from"./useAvatar.7737e550.js";import{u as O}from"./useToggles.4ea515b1.js";import{$ as S}from"./drop.cce90c26.js";import{s as P}from"./employees.2bffecd5.js";import{d as T}from"./departments.4f88a00d.js";import{_ as C}from"./Input.b03a61c6.js";import{_ as x}from"./TextArea.fcc59b75.js";import{_ as z}from"./UploadImage.edadea89.js";import{_ as D}from"./Toggle.9fd663bd.js";import{_ as R}from"./Select.bf4a4e1e.js";import{_ as G}from"./EditUser.e507be76.js";import{s as H}from"./roles.e9bab731.js";import{u as J}from"./useSuspense.29183c13.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./meta.48f5205a.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./Spinner.2e0ab286.js";const{current:L,setCurrent:N}=T,{select:Q}=P,{userDepartment:K,user:W}=E(),{apiRequest:X}=M(),Y=B(),Z=A("crud departments"),ee={id:"",name:"",surname:"",middle_name:"",email:"",phone:"",about:"",born_at:"",office_position:"",role_id:"",department_id:""};let ae,oe;const re=function(e){var a,o,r,l;"department_id"!==e?"role_id"!==e?ae[e]=null!=(l=this[e])?l:"":ae.role_id=Array.isArray(this.roles)?null==(r=this.roles[0])?void 0:r.id:"":ae.department_id=Z?null!=(o=null==(a=this.department)?void 0:a.id)?o:L.value:K.value};function le(){const{avatar:e,isUploadingAvatar:a,isValideAvatarFileSize:o,log:r,setAvatar:l,updateAvatar:f}=k(),{toggles:b,setToggles:_,bitwisedToggles:w}=O(),{route:g,isThePage:V,back:h}=q("EditEmployer");ae||(ae=p(s({},ee)));const{rules:y}=function(e,a=!1){const o=t((()=>({name:{required:i.withMessage("Укажите имя",d)},email:{required:i.withMessage("Укажите email",d),email:i.withMessage("Укажите верный email",n)},password:{minLength:i.withMessage("Не менее 8 символов",u(8))},password_confirmation:{sameAs:i.withMessage("Пароли не совпадают",m(e.password))},role_id:{required:i.withMessage("Укажите роль",d)},department_id:{required:i.withMessage("Укажите отделение",d)}})));return a||(o.value.password.required=i.withMessage("Укажите пароль",d)),{rules:o}}(ae,V.value);oe||(oe=c(y,ae,{$lazy:!0}));const j=async e=>{e&&Q(e),h()},$=async e=>{l(e),Object.keys(ae).forEach(re,e);const{is_about_visible:a,is_born_at_visible:o,is_active:r}=e;_({is_about_visible:a,is_born_at_visible:o,is_active:r}),ae.born_at&&(ae.born_at=F(ae.born_at))};return v((()=>{ae=void 0,oe=void 0})),{isValideAvatarFileSize:o,log:r,avatar:e,userFields:ae,isEditEmployerPage:V,v$:oe,saveUser:async()=>{var e,a;let r,l=await oe.value.$validate();if(l&&(l=o.value),!l)return;oe.value.$reset();const t=await(async()=>{const e={};Object.keys(ae).forEach((a=>{V.value&&"password"===a.substr(0,8)||(e[a]=`${ae[a]}`)}));const a=s(s({},e),w.value),{data:o}=await I.user(a,null,!0);return null==o?void 0:o.user})();r=!!t,r&&(r=await f(`/users/${null==t?void 0:t.id}/avatar`),V.value&&ae.password&&(r=await(async e=>{var a;const{call:o,errorMsg:r,success:l}=X(`/users/${e}/password`,{method:"put",data:{password:ae.password}});return await o(),l.value?(ae.password=null,ae.password_confirmation=null,Y.success("пароль успешно обновлен")):Y.danger(null!=(a=r.value)?a:"Что-то пошло не так, не удалось обновить пароль !"),l.value})(null==t?void 0:t.id)),V.value&&t.id==W.value.id&&W.value.roles[0].id!=(null==t?void 0:t.roles[0].id)?window.location="/dashboard":((null==(e=null==t?void 0:t.department)?void 0:e.id)&&N(null==(a=null==t?void 0:t.department)?void 0:a.id),r&&await j(null==t?void 0:t.id)))},toggles:b,setEmployerForm:$,atMountedEmployerForm:async()=>{const e=V.value&&g.params.id&&await S.user(g.params.id);await $(e||{})},isUploadingAvatar:a,previousPage:j}}const se={async setup(e){let a,o;const{options:r,load:l}=T,{options:s,load:t}=H,{isValideAvatarFileSize:i,log:d,avatar:n,userFields:u,v$:m,toggles:p,atMountedEmployerForm:c,isUploadingAvatar:v}=le();return[a,o]=f((()=>(async()=>{await t(),await l(),await c()})())),a=await a,o(),(e,a)=>(b(),_(G,null,{avatar:w((()=>[g(z,{onSelected:V(d),image:V(n),label:"Фото",class:"mb-3",error:V(i)?"":"Размер фото не должен превышать 10000 Кб",loader:V(v)},null,8,["onSelected","image","error","loader"])])),middle_name:w((()=>[g(C,{label:"Фамилия",modelValue:V(u).middle_name,"onUpdate:modelValue":a[0]||(a[0]=e=>V(u).middle_name=e)},null,8,["modelValue"])])),name:w((()=>{var e;return[g(C,{label:"Имя",modelValue:V(u).name,"onUpdate:modelValue":a[1]||(a[1]=e=>V(u).name=e),required:!0,error:null==(e=V(m).name.$errors[0])?void 0:e.$message,onBlured:V(m).name.$touch},null,8,["modelValue","error","onBlured"])]})),surname:w((()=>[g(C,{label:"Отчество",modelValue:V(u).surname,"onUpdate:modelValue":a[2]||(a[2]=e=>V(u).surname=e)},null,8,["modelValue"])])),email:w((()=>{var e;return[g(C,{autocomplete:"chrome-off",label:"Почта",type:"email",modelValue:V(u).email,"onUpdate:modelValue":a[3]||(a[3]=e=>V(u).email=e),required:!0,error:null==(e=V(m).email.$errors[0])?void 0:e.$message,onBlured:V(m).email.$touch},null,8,["modelValue","error","onBlured"])]})),phone:w((()=>[g(C,{label:"Телефон",mask:"+7 ### ###-##-##",modelValue:V(u).phone,"onUpdate:modelValue":a[4]||(a[4]=e=>V(u).phone=e)},null,8,["modelValue"])])),password:w((()=>{var e;return[g(C,{autocomplete:"chrome-off",label:"Новый пароль",type:"password",modelValue:V(u).password,"onUpdate:modelValue":a[5]||(a[5]=e=>V(u).password=e),required:!0,error:null==(e=V(m).password.$errors[0])?void 0:e.$message,onInput:V(m).password.$touch},null,8,["modelValue","error","onInput"])]})),password_confirmation:w((()=>{var e;return[g(C,{label:"Подтвердите новый пароль",type:"password",modelValue:V(u).password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=e=>V(u).password_confirmation=e),required:!0,error:null==(e=V(m).password_confirmation.$errors[0])?void 0:e.$message,onInput:V(m).password_confirmation.$touch},null,8,["modelValue","error","onInput"])]})),born_at:w((()=>[g(C,{label:"Дата рождения",type:"date",modelValue:V(u).born_at,"onUpdate:modelValue":a[7]||(a[7]=e=>V(u).born_at=e)},null,8,["modelValue"])])),office_position:w((()=>[g(C,{label:"Должность",modelValue:V(u).office_position,"onUpdate:modelValue":a[8]||(a[8]=e=>V(u).office_position=e)},null,8,["modelValue"])])),role:w((()=>{var e;return[g(R,{label:"Роль",options:V(s),modelValue:V(u).role_id,"onUpdate:modelValue":a[9]||(a[9]=e=>V(u).role_id=e),required:!0,error:null==(e=V(m).role_id.$errors[0])?void 0:e.$message,onBlured:V(m).role_id.$touch},null,8,["options","modelValue","error","onBlured"])]})),department:w((()=>{var e;return[g(R,{label:"Отделение",options:V(r),modelValue:V(u).department_id,"onUpdate:modelValue":a[10]||(a[10]=e=>V(u).department_id=e),required:!0,error:null==(e=V(m).department_id.$errors[0])?void 0:e.$message,onBlured:V(m).department_id.$touch},null,8,["options","modelValue","error","onBlured"])]})),about:w((()=>[g(x,{label:"О сотруднике",rows:"3",modelValue:V(u).about,"onUpdate:modelValue":a[11]||(a[11]=e=>V(u).about=e)},null,8,["modelValue"])])),settings:w((({item:e})=>[g(D,{modelValue:V(p)[e.key],"onUpdate:modelValue":a=>V(p)[e.key]=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}))}},te=j("Вернуться "),ie=j("Сохранить "),de={setup(e){const a=J(se),{saveUser:o,isEditEmployerPage:r,previousPage:l}=le();return(e,s)=>(b(),_($,{title:V(r)?"Обновить сотрудника":"Создание нового сотрудника"},{actions:w((()=>[g(U,{type:"secondary",onClick:s[0]||(s[0]=()=>V(l)())},{default:w((()=>[g(V(h),{class:"w-5 h-5 mr-1"}),te])),_:1}),g(U,{color:"green",onClick:V(o)},{default:w((()=>[g(V(y),{class:"w-5 h-5 mr-1"}),ie])),_:1},8,["onClick"])])),default:w((()=>[g(V(a))])),_:1},8,["title"]))}};export{de as default};
