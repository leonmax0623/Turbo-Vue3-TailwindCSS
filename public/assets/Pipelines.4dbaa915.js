import{V as e,o as a,d as s,j as t,u as r,c as o,E as i,F as n,S as l,H as m,I as d,ag as u,f as c,J as p,l as f,t as j,av as v,a1 as b}from"./vendor.36c281f3.js";import{_}from"./Office.55bfbecd.js";import{_ as w}from"./Button.4b020695.js";import{u as y}from"./useSuspense.29183c13.js";import{_ as g}from"./Link.4e9a6f0f.js";import{u as h}from"./useConfirmDialog.ba73d887.js";import{p as $}from"./index.ce6adbb1.js";import{_ as k}from"./Table.ec42ea9a.js";import{_ as M}from"./Input.b03a61c6.js";import{c as S,s as x}from"./useAvatar.7737e550.js";import{u as B}from"./useModalForm.1c23c14e.js";import{b as C}from"./index.8fc70fb6.js";import{$ as D}from"./drop.cce90c26.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./departments.4f88a00d.js";import"./meta.48f5205a.js";import"./Spinner.2e0ab286.js";import"./Dialog.b36041f9.js";import"./Th.32cd08d3.js";import"./useIntersectionObserver.7ad3d6a4.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./FormActions.47218f8a.js";const F={async setup(o){let i,n;const{pipeline:l,atMounted:m,v$:d}=q();return[i,n]=e((()=>m())),i=await i,n(),(e,o)=>{var i;return a(),s("div",null,[t(M,{label:"Название",modelValue:r(l).name,"onUpdate:modelValue":o[0]||(o[0]=e=>r(l).name=e),required:!0,error:null==(i=r(d).name.$errors[0])?void 0:i.$message,onBlured:r(d).name.$touch},null,8,["modelValue","error","onBlured"])])}}};const{add:I}=$,V=C();let A,E;const O=async()=>{const{id:e}=A;if(e){const a=await D.pipeline(e);((e={})=>{A.id=e.id,A.name=e.name})(null!=a?a:{})}},T=async()=>{if(!(await E.value.$validate()))return;E.value.$reset();const{message:e,success:a,data:s}=await x.pipeline(A);try{return{message:e,success:a}}finally{a&&(I(s.pipeline),V.success(e))}};function q(){return{pipeline:A,atMounted:O,render:(...e)=>{const a=l(!0);a.run((()=>{const s=o((()=>!!(null==A?void 0:A.id))),{render:t}=B({title:o((()=>S.modal[s.value?"update":"create"].pipeline)),RawForm:F,atSubmit:T,atClose:()=>a.stop(),atOpen:e=>{A=m({id:null!=e?e:"",name:""}),E=d(o((()=>({name:{required:i.withMessage("Укажите вопрос",n)}}))),A,{$lazy:!0})}});t(...e),u((()=>{A=void 0,E=void 0}))}))},v$:E}}const z={async setup(s){let o,i;const n=[{label:"Название",key:"name"},{label:"Дата создания",key:"created_at"}],{drop:l}=h(),{render:m}=q(),{state:d,load:u,drop:v}=$;return[o,i]=e((()=>u())),o=await o,i(),(e,s)=>(a(),c(k,{fields:n,items:r(d).raw,onDelete:s[0]||(s[0]=e=>r(l)((()=>r(v)(e)))),onEdit:s[1]||(s[1]=e=>r(m)(e))},{"td-name":p((({value:e,item:{id:a}})=>[t(g,{href:{name:"Stages",params:{id:a}}},{default:p((()=>[f(j(e),1)])),_:2},1032,["href"])])),"td-created_at":p((({value:e})=>{var a;return[f(j(null!=(a=null==e?void 0:e.split(" ")[0])?a:"_"),1)]})),_:1},8,["items"]))}},H=f("Назад "),J=f("Создать "),L={setup(e){const{render:s}=q(),o=y(z);return(e,i)=>(a(),c(_,{title:"Все воронки"},{actions:p((()=>[t(w,{type:"secondary",link:{name:"Tasks"}},{default:p((()=>[t(r(v),{class:"w-5 h-5 mr-1"}),H])),_:1}),t(w,{color:"blue",onClick:i[0]||(i[0]=()=>r(s)())},{default:p((()=>[t(r(b),{class:"w-5 h-5 mr-1"}),J])),_:1})])),default:p((()=>[t(r(o),{loadingMsg:"получение воронок..."})])),_:1}))}};export{L as default};
