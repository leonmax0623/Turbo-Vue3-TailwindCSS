import{L as e,M as l,V as s,w as a,o,d as i,e as t,j as d,u as n,h as p,W as m,X as c,J as r,l as u,c as f,t as b,f as _,av as V,v as j,a2 as v}from"./vendor.36c281f3.js";import{_ as k}from"./Office.55bfbecd.js";import{_ as h}from"./Button.4b020695.js";import{p as x,_ as g}from"./StoSelect.c03bfa6a.js";import{_ as y}from"./Files.f3d09fe4.js";import{_ as U}from"./Input.b03a61c6.js";import{_ as w}from"./Select.bf4a4e1e.js";import{s as C}from"./form.126ebbce.js";import{l as B,h as D,q as S}from"./useAvatar.7737e550.js";import{s as I}from"./employees.2bffecd5.js";import{d as T}from"./departments.4f88a00d.js";import{p as z}from"./index.ce6adbb1.js";import"./stages.b7bebdd4.js";import{o as O}from"./orders.a1ebe807.js";import{u as q}from"./useConfirmDialog.ba73d887.js";import{a as E,f as P}from"./index.8fc70fb6.js";import{s as A}from"./diagnostic-card.03bcc5f0.js";import{_ as F}from"./StoSelect.c4156f5b.js";import{u as M}from"./useSuspense.29183c13.js";import{t as $}from"./index.866650bf.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./meta.48f5205a.js";import"./Badge.4bd69676.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./drop.cce90c26.js";import"./index.e517b156.js";import"./Dialog.b36041f9.js";import"./Spinner.2e0ab286.js";import"./useIntersectionObserver.7ad3d6a4.js";import"./useOrder.941ce970.js";e("data-v-5ddb7e26");const J={class:"grid grid-cols-12 gap-6"},L={class:"col-span-12 sm:col-span-3"},N={class:"col-span-12 sm:col-span-3"},W={class:"col-span-12 sm:col-span-3"},X={class:"col-span-12 sm:col-span-3"},G={class:"col-span-12 sm:col-span-3"},H={class:"col-span-12 sm:col-span-3"},K={key:0,class:"col-span-12 sm:col-span-3"},Q={class:"col-span-12 sm:col-span-3"},R={class:"col-span-12 sm:col-span-3"},Y={key:1,class:"col-span-12 sm:col-span-4"},Z={class:"col-span-12 sm:col-span-12"},ee=u("Удалить"),le=u("Добавить"),se={key:2,class:"grid grid-cols-12 gap-6 col-span-12"},ae=t("hr",{class:"col-span-12"},null,-1),oe={class:"col-span-12 sm:col-span-12"},ie=t("hr",{class:"col-span-12"},null,-1),te={class:"col-span-12 sm:col-span-12"},de=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Чек лист",-1),ne={class:"w-5 pt-2"},pe=u("Удалить"),me=u("Добавить"),ce=t("hr",{class:"col-span-12"},null,-1);l();const re={async setup(e){let l,u;const{route:_}=E(),{simple:V}=q(),{current:j}=T,{load:v,options:k}=I,{options:P,load:M}=O,{state:$,load:re,options:ue}=z,{options:fe,load:be}=A,{fields:_e,atMounted:Ve,log:je,isEditPage:ve}=C(_.query.order_id),ke=Object.entries(B).map((([e,{label:l}])=>({label:l,value:e}))),he=e=>S((l=>e.splice(l,1)),f((()=>e.length>1)));let xe,ge;[l,u]=s((()=>{var e,l;return Promise.all([M({department_id:null!=(e=j.value)?e:""}),v({department_id:null!=(l=j.value)?l:""}),re(),be(),Ve()]).then((()=>{xe=he(_e.checkboxes),ge=he(_e.pipelines)}))})),l=await l,u(),a((()=>_e.is_map),(e=>{_e.checkboxes=[{description:""}],_e.temp_file_ids=[],_e.delete_file_ids=[],_e.files=[],_e.description=""}));const ye=x($,_e),Ue=[{label:"Задача",value:"false"},{label:"Диагностическая карта",value:"true"}];return(e,l)=>(o(),i("div",J,[t("div",L,[d(w,{"hide-text":!0,label:"Тип",modelValue:n(_e).is_map,"onUpdate:modelValue":l[0]||(l[0]=e=>n(_e).is_map=e),options:Ue},null,8,["modelValue"])]),t("div",N,[d(U,{label:"Название задачи",modelValue:n(_e).name,"onUpdate:modelValue":l[1]||(l[1]=e=>n(_e).name=e)},null,8,["modelValue"])]),t("div",W,[d(U,{label:"Крайний срок",type:"date",modelValue:n(_e).deadline_at,"onUpdate:modelValue":l[2]||(l[2]=e=>n(_e).deadline_at=e),min:n(D)(new Date)},null,8,["modelValue","min"])]),t("div",X,[d(F,{onBottomTouched:l[3]||(l[3]=()=>{}),label:"Исполнитель",options:n(k),modelValue:n(_e).user_id,"onUpdate:modelValue":l[4]||(l[4]=e=>n(_e).user_id=e)},null,8,["options","modelValue"])]),t("div",G,[d(F,{onBottomTouched:l[5]||(l[5]=()=>{}),label:"Заказ наряд",options:n(P),modelValue:n(_e).order_id,"onUpdate:modelValue":l[6]||(l[6]=e=>n(_e).order_id=e),disabled:n(_).query.order_id},null,8,["options","modelValue","disabled"])]),t("div",H,[d(U,{label:"Позиция",type:"number",step:1,modelValue:n(_e).position,"onUpdate:modelValue":l[7]||(l[7]=e=>n(_e).position=e)},null,8,["modelValue"])]),n(ve)?(o(),i("div",K,[d(w,{label:"Статус",options:n(ke),modelValue:n(_e).status,"onUpdate:modelValue":l[8]||(l[8]=e=>n(_e).status=e)},null,8,["options","modelValue"])])):p("",!0),t("div",Q,[d(U,{label:"Начать с",type:"date",modelValue:n(_e).start_at,"onUpdate:modelValue":l[9]||(l[9]=e=>n(_e).start_at=e),min:n(D)(new Date)},null,8,["modelValue","min"])]),t("div",R,[d(U,{label:"Конец в",type:"date",modelValue:n(_e).end_at,"onUpdate:modelValue":l[10]||(l[10]=e=>n(_e).end_at=e),min:n(D)(new Date)},null,8,["modelValue","min"])]),"true"==n(_e).is_map?(o(),i("div",Y,[d(w,{label:"Шаблон диагностической карты",options:n(fe),modelValue:n(_e).map_id,"onUpdate:modelValue":l[11]||(l[11]=e=>n(_e).map_id=e)},null,8,["options","modelValue"])])):p("",!0),t("div",Z,[t("ul",null,[(o(!0),i(m,null,c(n(_e).pipelines,((e,s)=>(o(),i("li",{key:"input-"+s,class:"flex items-center"},[d(F,{onBottomTouched:l[12]||(l[12]=()=>{}),class:"mr-3 pipeline w-full",label:`Воронка ${s+1}`,options:n(ue),modelValue:n(_e).pipelines[s].pipeline_id,"onUpdate:modelValue":e=>n(_e).pipelines[s].pipeline_id=e},null,8,["label","options","modelValue","onUpdate:modelValue"]),d(n(ye),{index:s,pipeline_id:n(_e).pipelines[s].pipeline_id,modelValue:n(_e).pipelines[s].stage_id,"onUpdate:modelValue":e=>n(_e).pipelines[s].stage_id=e},null,8,["index","pipeline_id","modelValue","onUpdate:modelValue"]),d(h,{color:"red",size:"sm",onClick:e=>n(ge)(s)},{default:r((()=>[ee])),_:2},1032,["onClick"])])))),128))]),d(h,{size:"xs",class:"mt-4",onClick:l[13]||(l[13]=e=>n(_e).pipelines.push({}))},{default:r((()=>[le])),_:1})]),"false"==n(_e).is_map?(o(),i("div",se,[ae,t("div",oe,[d(g,{label:"Текст задачи",modelValue:n(_e).description,"onUpdate:modelValue":l[14]||(l[14]=e=>n(_e).description=e)},null,8,["modelValue"])]),ie,t("div",te,[de,t("ul",null,[(o(!0),i(m,null,c(n(_e).checkboxes,((e,l)=>(o(),i("li",{key:"input-"+l,class:"flex items-start mb-2"},[t("span",ne,b(l+1),1),d(U,{rows:"1",class:"flex-grow mx-2",placeholder:"Текст задачи",modelValue:n(_e).checkboxes[l].description,"onUpdate:modelValue":e=>n(_e).checkboxes[l].description=e},null,8,["modelValue","onUpdate:modelValue"]),d(h,{color:"red",size:"sm",onClick:e=>n(xe)(l)},{default:r((()=>[pe])),_:2},1032,["onClick"])])))),128))]),d(h,{size:"xs",class:"mt-4",onClick:l[15]||(l[15]=e=>n(_e).checkboxes.push({description:""}))},{default:r((()=>[me])),_:1})]),ce,d(y,{log:n(je),files:n(_e).files,onFileDropped:l[16]||(l[16]=e=>n(V)((()=>(e=>{_e.delete_file_ids.push(e),_e.files.deleteById(e)})(e))))},null,8,["log","files"])])):p("",!0)]))},__scopeId:"data-v-5ddb7e26"},ue=u("Назад "),fe=u("Сохранить "),be=u("Удалить "),_e={setup(e){const{current:l}=T,{isEditPage:s,saveTask:a,route:i,back:t,fields:m}=C(),{removeTask:c}=$(),u=M(re);return(e,f)=>(o(),_(k,{title:n(s)?"Обновление задачи":"Создание новой задачи"},{actions:r((()=>[d(h,{type:"secondary",onClick:n(t)},{default:r((()=>[d(n(V),{class:"w-5 h-5 mr-1"}),ue])),_:1},8,["onClick"]),d(h,{color:"green",onClick:n(a)},{default:r((()=>[d(n(j),{class:"w-5 h-5 mr-1"}),fe])),_:1},8,["onClick"]),n(s)&&n(P)(n(m),"delete")?(o(),_(h,{key:0,color:"red",onClick:f[0]||(f[0]=()=>n(c)(n(i).params.id,!0))},{default:r((()=>[d(n(v),{class:"w-5 h-5 mr-1"}),be])),_:1})):p("",!0)])),default:r((()=>[n(l)?(o(),_(n(u),{key:`task-${n(l)}`})):p("",!0)])),_:1},8,["title"]))}};export{_e as default};
