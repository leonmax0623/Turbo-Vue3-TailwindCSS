var e=Object.defineProperty,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(a,s,r)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[s]=r,o=(e,o)=>{for(var l in o||(o={}))s.call(o,l)&&t(e,l,o[l]);if(a)for(var l of a(o))r.call(o,l)&&t(e,l,o[l]);return e};import{a as l,b as i,e as n,_ as d}from"./index.8fc70fb6.js";import{L as u,M as c,o as m,d as p,e as b,W as _,X as f,t as v,j as g,J as y,n as O,T as j,c as E,E as w,F as h,S as k,H as x,r as V,I as P,P as T,au as D,w as I,f as $,u as A,ag as L,av as M,a2 as R,h as C,g as S,aw as q,ax as z,l as F}from"./vendor.36c281f3.js";import{_ as W}from"./Office.55bfbecd.js";import{_ as B}from"./Button.4b020695.js";import{u as H}from"./useSuspense.29183c13.js";import{$ as J}from"./drop.cce90c26.js";import{j as N,u as U,s as X,c as G,g as K}from"./useAvatar.7737e550.js";import{o as Q}from"./orders.a1ebe807.js";import{d as Y}from"./departments.4f88a00d.js";import{u as Z}from"./useConfirmDialog.ba73d887.js";u("data-v-83c6fdf4");const ee={class:"sm:hidden"},ae=b("label",{for:"tabs",class:"sr-only"},"Выберите пункт",-1),se=["selected","value"],re={class:"hidden sm:block"},te={class:"border-b-2 border-gray-200 z-0"},oe=["onClick","aria-current"];c();const le={props:{modelValue:{type:[Number,String],required:!1},tabs:Array},emits:["update:modelValue"],setup(e,{emit:a}){const s=e=>{a("update:modelValue",e)};return(a,r)=>(m(),p("div",null,[b("div",ee,[ae,b("select",{class:"block mt-4 w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",onChange:r[0]||(r[0]=e=>s(e.target.value))},[(m(!0),p(_,null,f(e.tabs,((a,s)=>(m(),p("option",{key:`option-tab-${s}`,selected:a.tab==e.modelValue,value:a.tab},v(a.label),9,se)))),128))],32)]),b("div",re,[b("div",te,[g(j,{name:"tabs",tag:"nav",class:"-mb-px flex space-x-6"},{default:y((()=>[(m(!0),p(_,null,f(e.tabs,((a,r)=>(m(),p("div",{key:`tab-${r}`,class:"flex"},[b("button",{onClick:()=>s(a.tab),"aria-current":a.tab==e.modelValue?"page":void 0,class:O([a.tab==e.modelValue?"cursor-pointer border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","border-b-2 cursor-pointer whitespace-nowrap py-4 px-1 font-medium text-sm"])},v(a.label),11,oe)])))),128))])),_:1})])])]))}};le.__scopeId="data-v-83c6fdf4";const{current:ie}=Y,{drop:ne}=Q,de=i();let ue,ce,me,pe,be;const _e={id:"",user_id:"",client_id:"",order_stage_id:"",car_id:"",appeal_reason_id:"",process_category_id:"",total_sum:"",comment:""},fe={department_id:ie},ve=()=>o(o(o({},N(_e)),fe),{checkboxes:[""],temp_file_ids:[],delete_file_ids:[]}),ge=()=>{ue=void 0,me=void 0,ce=void 0,be=void 0},ye=function(e){var a,s,r;if(e.includes("_id")){if("temp_file_ids"===e)return;if("delete_file_ids"===e)return;if(["pipeline_id","department_id"].includes(e))return;return"order_stage_id"===e?void(ue.order_stage_id=null==(a=this.stage)?void 0:a.id):void(ue[e]=null==(s=this[e.replace("_id","")])?void 0:s.id)}ue[e]="checkboxes"!==e?"temp_file_ids"!==e?null!=(r=this[e])?r:_e[e]:[]:[""]},Oe=async e=>{Object.keys(ue).forEach(ye,null!=e?e:{}),e&&Object.keys(e).forEach((a=>{ce[a]=e[a]}))},je=async(e,a=!1)=>{if(a&&ue.id)return;const s=await J.order(null!=e?e:pe);Oe(s)},Ee=e=>{me.value=e.target.files};var we=()=>k().run((()=>{const{route:e,isThePage:a,redirectTo:s,router:r}=l("OrderEdit");if(!ue){ue=x(ve()),ce=x({}),me=V(),pe=e.params.id;const a=E((()=>({order_stage_id:{required:w.withMessage("Выберите этап",h)}})));be=P(a,ue,{$lazy:!0})}return{fields:ue,isEditPage:a,saveOrder:async()=>{var e,a,r,t;if(!(await be.value.$validate()))return;be.value.$reset();const o=null!=(a=null==(e=me.value)?void 0:e.length)?a:0;if(o){const e=new FormData;for(let r=0;r<o;r++)e.append("files[]",me.value[0]);const{message:a,success:s,data:t}=await U("temp/files",e);if(s?de.success("Файлы успешно загружены"):de.danger(null!=a?a:"Что-то пошло не так, не удалось загрузить файлы"),!s)return;ue.temp_file_ids=null==(r=null==t?void 0:t.files)?void 0:r.map((({id:e})=>e))}const{success:l,data:i}=await X.order(ue,null,!0);l&&s({name:"OrderEdit",params:{id:null==(t=i.order)?void 0:t.id}})},atMounted:async()=>{const{id:s}=e.params;a.value&&s?await je(e.params.id):Oe(ve())},log:Ee,current:ie,clearMemory:ge,dropOrder:async()=>{const{success:a,message:r}=await ne(e.params.id);a&&s({name:"Orders"});const t=null!=r?r:G.drop[a?"success":"error"];try{return{success:a,message:t}}finally{de[a?"success":"danger"](t)}},route:e,setOrder:je,router:r,rawFields:ce,v$:be}}));const he={class:"mr-2 text-lg"},ke=F("Сумма: "),xe={class:"font-bold"},Ve=F("К заказ-нарядам "),Pe=F("Удалить "),Te={setup(e){var a;const{drop:s}=Z(),{current:r}=Y,{fields:t,isEditPage:o,clearMemory:l,dropOrder:i,route:u,router:c,atMounted:p}=we();T((async()=>{(null==t?void 0:t.id)||await p()}));const _=H(),f=[{tab:"main",permissions:[],label:"Форма",component:D((()=>d((()=>import("./Main.a9b2a554.js")),["assets/Main.a9b2a554.js","assets/vendor.36c281f3.js","assets/Button.4b020695.js","assets/TextArea.fcc59b75.js","assets/ExclamationCircleIcon.22c0ccb9.js","assets/Input.b03a61c6.js","assets/StoSelect.c4156f5b.js","assets/StoSelect.9b6531fb.css","assets/useIntersectionObserver.7ad3d6a4.js","assets/employees.2bffecd5.js","assets/drop.cce90c26.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/useAvatar.7737e550.js","assets/clients.e20f9038.js","assets/cars.41f6223d.js","assets/why.059bca86.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js","assets/headlessui.esm.b519f347.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/index.a1f0654c.js","assets/stages.6e22bacf.js","assets/CarFormFields.c5e9346f.js","assets/CarFormFields.c749a623.css","assets/Select.bf4a4e1e.js","assets/marks.50b903c7.js","assets/carModelForm.2c8ceb25.js","assets/useModalForm.1c23c14e.js","assets/useModalForm.96e426c9.css","assets/FormActions.47218f8a.js","assets/useSuspense.29183c13.js","assets/carModel.5c695b93.js","assets/departments.4f88a00d.js","assets/carMarkForm.6681b855.js","assets/ClientFormFields.5fcad639.js","assets/CarsTable.14d70802.js","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/cars.efc7eb58.js","assets/Table.ec42ea9a.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/Files.f3d09fe4.js","assets/Files.0e3eaa2f.css","assets/Badge.4bd69676.js","assets/Office.55bfbecd.js","assets/Office.a4a7813b.css","assets/Avatar.4eeca634.js","assets/NavBar.2f63176e.js","assets/meta.48f5205a.js","assets/orders.a1ebe807.js"])))},{tab:"tasks",permissions:[],label:"Задачи",component:D((()=>d((()=>import("./Tasks.767cd1b0.js")),["assets/Tasks.767cd1b0.js","assets/vendor.36c281f3.js","assets/Button.4b020695.js","assets/useSuspense.29183c13.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/Table.e1bf0ba6.js","assets/Table.9a993bb1.css","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Badge.4bd69676.js","assets/Avatar.4eeca634.js","assets/useAvatar.7737e550.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/index.e517b156.js","assets/drop.cce90c26.js","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useIntersectionObserver.7ad3d6a4.js","assets/index.866650bf.js","assets/useOrder.941ce970.js","assets/departments.4f88a00d.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js"])))},{tab:"docs",permissions:["crud documents","crud document templates"],label:"Документы",component:D((()=>d((()=>import("./Docs.1a7da887.js")),["assets/Docs.1a7da887.js","assets/drop.cce90c26.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/vendor.36c281f3.js","assets/useAvatar.7737e550.js","assets/useSuspense.29183c13.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Button.4b020695.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useIntersectionObserver.7ad3d6a4.js","assets/Badge.4bd69676.js"])))},{tab:"storages",permissions:[],label:"Склад",component:D((()=>d((()=>import("./Storages.f59bf467.js")),["assets/Storages.f59bf467.js","assets/vendor.36c281f3.js","assets/Button.4b020695.js","assets/Input.b03a61c6.js","assets/ExclamationCircleIcon.22c0ccb9.js","assets/Select.bf4a4e1e.js","assets/storage-requests.df03da5b.js","assets/drop.cce90c26.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/useAvatar.7737e550.js","assets/index.d9cbb9ba.js","assets/departments.4f88a00d.js","assets/StoSelect.c4156f5b.js","assets/StoSelect.9b6531fb.css","assets/useIntersectionObserver.7ad3d6a4.js","assets/useModalForm.1c23c14e.js","assets/useModalForm.96e426c9.css","assets/FormActions.47218f8a.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/useSuspense.29183c13.js","assets/Badge.4bd69676.js","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js","assets/Office.55bfbecd.js","assets/Office.a4a7813b.css","assets/Avatar.4eeca634.js","assets/NavBar.2f63176e.js","assets/meta.48f5205a.js","assets/orders.a1ebe807.js"])))},{tab:"works",permissions:["crud works","read works"],label:"Работы",component:D((()=>d((()=>import("./Works.002a82b2.js")),["assets/Works.002a82b2.js","assets/vendor.36c281f3.js","assets/Button.4b020695.js","assets/Input.b03a61c6.js","assets/ExclamationCircleIcon.22c0ccb9.js","assets/Select.bf4a4e1e.js","assets/TextArea.fcc59b75.js","assets/employees.2bffecd5.js","assets/drop.cce90c26.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/useAvatar.7737e550.js","assets/departments.4f88a00d.js","assets/useModalForm.1c23c14e.js","assets/useModalForm.96e426c9.css","assets/FormActions.47218f8a.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/useSuspense.29183c13.js","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Avatar.4eeca634.js","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useIntersectionObserver.7ad3d6a4.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js","assets/Office.55bfbecd.js","assets/Office.a4a7813b.css","assets/NavBar.2f63176e.js","assets/meta.48f5205a.js","assets/orders.a1ebe807.js"])))},{tab:"diagnostic-card",permissions:[],label:"Диагностическая карта",component:D((()=>d((()=>import("./DiagnosticCards.7ec61b7c.js")),["assets/DiagnosticCards.7ec61b7c.js","assets/vendor.36c281f3.js","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/Badge.4bd69676.js","assets/Avatar.4eeca634.js","assets/useAvatar.7737e550.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/Table.e1bf0ba6.js","assets/Table.9a993bb1.css","assets/index.e517b156.js","assets/drop.cce90c26.js","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Button.4b020695.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useIntersectionObserver.7ad3d6a4.js","assets/index.866650bf.js","assets/useOrder.941ce970.js","assets/departments.4f88a00d.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js","assets/useSuspense.29183c13.js","assets/DiagnosticCardPreview.d449045c.js","assets/DiagnosticCardPreview.dd9e7433.css"])))},{tab:"comments",permissions:[],label:"Комментарии",component:D((()=>d((()=>import("./Comments.ea5d3474.js")),["assets/Comments.ea5d3474.js","assets/Comments.442d422e.css","assets/vendor.36c281f3.js","assets/Button.4b020695.js","assets/TextArea.fcc59b75.js","assets/ExclamationCircleIcon.22c0ccb9.js","assets/drop.cce90c26.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/useAvatar.7737e550.js","assets/Avatar.4eeca634.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css"]))),props:{model:"order",id:E((()=>{var e,a;return`${null!=(a=null==(e=u.params)?void 0:e.id)?a:""}`}))}},{tab:"payment",permissions:[],label:"Оплаты",component:D((()=>d((()=>import("./Payment.ade90437.js")),["assets/Payment.ade90437.js","assets/vendor.36c281f3.js","assets/Table.ec42ea9a.js","assets/headlessui.esm.b519f347.js","assets/Button.4b020695.js","assets/Dropdown.df5c89e3.js","assets/Th.32cd08d3.js","assets/useIntersectionObserver.7ad3d6a4.js","assets/Link.4e9a6f0f.js","assets/Link.591c72ce.css","assets/Badge.4bd69676.js","assets/useConfirmDialog.ba73d887.js","assets/Dialog.b36041f9.js","assets/Spinner.2e0ab286.js","assets/Spinner.d6776ee7.css","assets/Pay.968f65cd.js","assets/Pay.dbaf02c0.css","assets/useAvatar.7737e550.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css","assets/drop.cce90c26.js","assets/useModalForm.1c23c14e.js","assets/useModalForm.96e426c9.css","assets/FormActions.47218f8a.js","assets/useSuspense.29183c13.js","assets/Input.b03a61c6.js","assets/ExclamationCircleIcon.22c0ccb9.js","assets/Select.bf4a4e1e.js","assets/departments.4f88a00d.js","assets/groups.5d62c0cb.js","assets/orders.a1ebe807.js","assets/useOrder.941ce970.js"])))}],O=V(o.value&&null!=(a=u.query.tab)?a:"main");o.value&&I(O,(e=>{c.push({name:"OrderEdit",params:u.params,query:{tab:e}})}),{immediate:!0});const j=E((()=>f.find((({tab:e})=>e===O.value)))),w=E((()=>o.value?f.filter((({permissions:e})=>n(e,!0))).map((({tab:e,label:a})=>({label:a,tab:e}))):[{label:f[0].label,tab:f[0].tab}]));return L(l),(e,a)=>(m(),$(W,{title:A(o)?`Заказ-наряд #${A(K)(A(u).params.id)}`:"Создание нового заказ наряда"},{actions:y((()=>{var e,r;return[b("div",he,[ke,b("span",xe,v(null!=(r=null==(e=A(t))?void 0:e.total_sum)?r:" ..., ... ")+" ₽",1)]),g(B,{type:"secondary",link:{name:"Orders"}},{default:y((()=>[g(A(M),{class:"w-5 h-5 mr-1"}),Ve])),_:1}),A(o)?(m(),$(B,{key:0,color:"red",onClick:a[0]||(a[0]=()=>A(s)(A(i)))},{default:y((()=>[g(A(R),{class:"w-5 h-5 mr-1"}),Pe])),_:1})):C("",!0)]})),before:y((()=>[g(le,{modelValue:O.value,"onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e),tabs:A(w),class:"px-3 sm:px-4 lg:px-5"},null,8,["modelValue","tabs"])])),default:y((()=>{var e,a;return[O.value&&A(r)?(m(),$(A(_),{key:`order-form-${O.value}-${A(r)}-${null!=(a=null==(e=A(u).params)?void 0:e.id)?a:"none"}`},{default:y((()=>[(m(),$(S(A(j).component),q(z(A(j).props)),null,16))])),_:1})):C("",!0)]})),_:1},8,["title"]))}};var De=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Te});export{De as O,je as a,we as s};
