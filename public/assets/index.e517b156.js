var e=Object.defineProperty,a=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,s=(a,n,r)=>n in a?e(a,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[n]=r,p=(e,a)=>{for(var n in a||(a={}))i.call(a,n)&&s(e,n,a[n]);if(r)for(var n of r(a))t.call(a,n)&&s(e,n,a[n]);return e},l=(e,r)=>a(e,n(r));import{$ as o,_ as d}from"./drop.cce90c26.js";import{H as g,a as c,c as u}from"./vendor.36c281f3.js";const f=g({raw:[],pages:100,page:1,pending:!1});var w={state:c(f),findTask:e=>f.raw.find((({id:a})=>a==e)),load:async(e={},a=!0)=>{if(f.pending)return;f.pending=!0;const n=await o.tasks(e);f.pending=!1,f.raw=null!=n?n:[]},drop:async e=>d.task(e,(e=>{f.raw.deleteById(e)})),setTaskFunnelStage:(e,a,n)=>{const r=f.raw.findIndex((({id:a})=>a==e));if(r<0)return;const i=f.raw[r].pipelines;if(!i)return;const t=i.findIndex((({pipeline:{id:e}})=>e==a));t<0||(f.raw[r].pipelines[t].stage=p({},n))},reset:()=>{f.raw=[],f.pages=100,f.page=1},sort:e=>{f.raw.sort(e)},fill:async(e={},a=!0)=>{var n,r,i;if(f.pending)return;if(f.page>f.pages)return;f.pending=!0;const t=await o({key:"tasks",params:l(p({},e),{page:f.page})});f.raw=f.raw.concat(null!=(n=null==t?void 0:t.tasks)?n:[]),f.pages=null!=(i=null==(r=null==t?void 0:t.meta)?void 0:r.last_page)?i:100,f.page+=1,f.pending=!1},setTask:e=>{const a=f.raw.findIndex((({id:a})=>a===e.id));a<0||(f.raw[a]=e)},getTaskById:e=>f.raw.find((({id:a})=>e==a)),tasksInFunnel:e=>f.raw.filter((({pipelines:a})=>null==a?void 0:a.some((({pipeline:{id:a}})=>a==e)))),fillArchived:async(e={},a=!0)=>{var n,r,i;if(f.pending)return;if(f.page>f.pages)return;f.pending=!0;const t=await o({key:"tasks/history",params:l(p({},e),{page:f.page})});f.raw=f.raw.concat(null!=(n=null==t?void 0:t.tasks)?n:[]),f.pages=null!=(i=null==(r=null==t?void 0:t.meta)?void 0:r.last_page)?i:100,f.page+=1,f.pending=!1},options:u((()=>f.raw.map((({id:e,name:a})=>({label:a,value:e}))))),map_options:u((()=>f.raw.filter((({is_map:e})=>e)).map((({id:e,name:a})=>({label:a,value:e})))))};export{w as s};
