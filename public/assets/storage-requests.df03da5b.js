var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,u=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&d(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&d(e,r,t[r]);return e};import{$ as c,_ as n}from"./drop.cce90c26.js";import{H as i,c as l,a as p}from"./vendor.36c281f3.js";import{s as w}from"./useAvatar.7737e550.js";import{b as f}from"./index.8fc70fb6.js";const v=i({raw:[],inStock:!0,selectedId:void 0,pages:1e3,page:1,pending:!1}),g=e=>{var t;for(let r=0;r<v.raw.length;r++)if((null==(t=v.raw[r])?void 0:t.id)==e)return r},y=l((()=>v.raw.filter((({count:e})=>v.inStock?e>0:0===e))));var m={state:p(v),setAvailability:e=>{v.inStock=null!=e&&e},load:async(e={})=>{v.raw=await c.products(e)},sort:e=>{v.raw.sort(e)},drop:async e=>n.product(e,(e=>{v.raw.deleteById(e)})),reset:(e=!1)=>{v.raw=[],v.pages=1e3,v.page=1,e&&(v.selectedId=void 0),v.inStock=!0},fill:async e=>{var a,s,o;if(v.pending)return;if(v.page>v.pages)return;v.pending=!0;const d=await c({key:"products",params:(n=u({},e),i={page:v.page},t(n,r(i)))});var n,i;v.raw=v.raw.concat(null!=(a=null==d?void 0:d.products)?a:[]),v.pages=null!=(o=null==(s=null==d?void 0:d.meta)?void 0:s.last_page)?o:100,v.page+=1,v.pending=!1},select:e=>{e=Number(e),v.selectedId=Number.isNaN(e)?void 0:e},findProduct:e=>v.raw.find((({id:t})=>e==t)),replace:e=>{if(!e.id)return;const t=v.raw.findIndex((({id:t})=>t===e.id));v.raw[t]=e},selected:l((()=>!!v.selectedId)),products:y,options:l((()=>v.raw.map((({id:e,name:t})=>({value:e,label:t}))))),locallyDropProduct:e=>{v.raw.deleteById(e)},getProducts:e=>l((()=>{const t=v.raw.filter((({count:e})=>v.inStock?e>0:0===e));if(!e)return t;return t.filter((({product_requests:e})=>((e=[],t)=>e.some((({status:e})=>e===t)))(e,"wait")))})),dropRequestFromProduct:(e,t)=>{v.raw[g(t)].product_requests.deleteById(e)},updateCount:(e,t)=>{v.raw[g(e)].count+=t},addProductRequest:(e,t)=>{v.raw[g(e)].product_requests.push(t)}};const b=f(),j=i({raw:[],statuses:[]}),q=l((()=>((e=[])=>e.reduce(((e,t)=>{var r;const a=null==(r=t.product)?void 0:r.id;return a in e?e[a].push(t):e[a]=[t],e}),{}))(j.raw)));var I={state:p(j),load:async e=>{j.raw=await c.products_requests(e)},drop:async e=>n.products_request(e,(e=>j.raw.deleteById(e))),reset:()=>{j.raw=[],j.statuses=[]},loadStatuses:async()=>{const{success:e,statuses:t}=await c({key:"products-requests/get-statuses"});e&&(j.statuses=t)},productsRequests:q,replace:e=>{var t;if(e.id)for(let r=0;r<j.raw.length;r++)(null==(t=j.raw[r].product)?void 0:t.id)===(null==e?void 0:e.id)&&(j.raw[r].product=e)},add:e=>{const t=j.raw.findIndex((({id:t})=>(null==e?void 0:e.id)==t));t<0?j.raw.push(e):j.raw[t]=e},products:l((()=>Object.entries(q.value).map((([e,[{product:t}]])=>t)))),setRequestStatus:async(e,t)=>{if(!e)return;const{success:r,message:a}=await w({path:`products-requests/${e}/status`,data:{status:t}});return r?b.success("Товар выдан"):b.danger(null!=a?a:"что-то пошло не так")},dropProduct:e=>{e&&(j.raw=j.raw.filter((({product:{id:t}})=>e!=t)))}};export{m as a,I as s};
