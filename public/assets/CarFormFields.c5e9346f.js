import{c as e,E as a,F as l,aU as o,aV as s,H as r,U as n,I as d,ag as t,S as i,a as c,V as u,w as m,P as p,o as v,d as f,e as _,j as b,u as g,aA as y,a1 as V,t as w,N as x,at as h}from"./vendor.36c281f3.js";import{_ as X}from"./Input.b03a61c6.js";import{_ as j}from"./TextArea.fcc59b75.js";import{_ as M}from"./Select.bf4a4e1e.js";import{a as $}from"./index.8fc70fb6.js";import{s as k}from"./marks.50b903c7.js";import{s as U,c as C}from"./carModelForm.2c8ceb25.js";import{$ as F}from"./drop.cce90c26.js";import{c as I}from"./clients.e20f9038.js";import{d as q}from"./departments.4f88a00d.js";import{_ as S}from"./StoSelect.c4156f5b.js";import{s as B}from"./carMarkForm.6681b855.js";import{s as E,c as P}from"./useAvatar.7737e550.js";import{u as A}from"./useModalForm.1c23c14e.js";import{c as T}from"./cars.41f6223d.js";let O,z,D,H,L,N,R;const Y=async(e=!1)=>{var a;if(!(await H.value.$validate()))return;H.value.$reset();const{success:l,message:o,data:s}=await E.car(N,null,!0);if(!e){if(!l)return;return D(),l}{const{load:e}=T;try{return{message:o,success:l}}finally{l&&await e({client_id:null==(a=s.car.client)?void 0:a.id})}}},G=function(e){var a,l,o,s;if(e.includes("_id"))return N[e]=null==(a=this[e.replace("_id","")])?void 0:a.id,void("car_model_id"===e&&(R.value=null==(o=null==(l=this.car_model)?void 0:l.car_mark)?void 0:o.id));N[e]=null!=(s=this[e])?s:""},J=t=>{if(N)return;const{route:i,isThePage:c,back:u}=$("EditCar");[O,z,D]=[i,c,u],N=r({id:"",number:"",vin:"",year:"",body:"",color:"",notes:"",fuel_id:"",engine_volume_id:"",client_id:null!=t?t:"",car_model_id:""}),R=n(),H=d(e((()=>({client_id:{required:a.withMessage("Выберите владельца",l)},car_model_id:{required:a.withMessage("Выберите модель автомобиля",l)},year:{minValue:a.withMessage("Год выпуска должен быть больше 1950",o(1950))},vin:{maxLength:a.withMessage("максимально допустимое количество символов 20",s(20))}}))),N,{$lazy:!0})},K=async e=>{var a;if(e)return;let l={client:{id:null==(a=null==O?void 0:O.query)?void 0:a.client_id}};z.value&&O.params.id&&(l=await F.car(O.params.id)),await(async e=>{Object.keys(N).forEach(G,e)})(l)},Q=()=>t((()=>{O=void 0,z=void 0,D=void 0,N=void 0,R=void 0,L=void 0,H=void 0}));function W(a=!1){return a?L=(...a)=>{const l=i();l.run((()=>{const o=e((()=>!!N.id)),{render:s}=A({title:e((()=>P.modal[o.value?"update":"create"].car)),RawForm:Ve,atSubmit:()=>Y(!0),atClose:()=>l.stop(),atOpen:()=>J(...a)});s(...a),Q()}))}:(J(),Q()),{routeInstance:O,isEditCarPage:z,render:L,carFields:N,saveCar:()=>Y(!1),atMountedCarForm:K,theSelectedCarMark:R,v$:H}}const Z=r({raw:[]});var ee={state:c(Z),reset:()=>{Z.raw=[]},load:async()=>{Z.raw=await F.engine_volumes()},options:e((()=>Z.raw.map((({id:e,value:a})=>({value:e,label:a}))).sort(((e,a)=>e.value-a.value))))};const ae=r({raw:[]});var le={state:c(ae),reset:()=>{ae.raw=[]},load:async()=>{ae.raw=await F.fuels()},options:e((()=>ae.raw.map((({id:e,name:a})=>({value:e,label:a})))))};const oe={class:"grid grid-cols-12 gap-6"},se={class:"col-span-12 sm:col-span-6 md:col-span-4"},re={class:"col-span-12 sm:col-span-6 md:col-span-4"},ne={class:"col-span-12 sm:col-span-6 md:col-span-4"},de={class:"col-span-12 sm:col-span-6 md:col-span-4"},te={class:"col-span-12 sm:col-span-6 md:col-span-4 flex items-center justify-center"},ie={class:"col-span-12 sm:col-span-6 md:col-span-4 flex items-center justify-center"},ce={class:"col-span-12 sm:col-span-6 md:col-span-3"},ue={class:"col-span-12 sm:col-span-6 md:col-span-3"},me=_("label",{for:"engine-volume",class:"block text-sm font-medium text-gray-700 text-left mb-1"},"Двигатель",-1),pe={class:"border border-gray-300 rounded flex items-center"},ve={class:"h-9 w-16 text-center border-r border-gray-300 font-light text-xl rounded py-1 px-3"},fe={class:"px-3 flex-grow flex flex-col items-center"},_e=["max"],be={class:"col-span-12 sm:col-span-6 md:col-span-3"},ge={class:"col-span-12 sm:col-span-6 md:col-span-3"},ye={class:"col-span-12 sm:col-span-12"},Ve={props:{inModal:{type:Boolean,default:!0}},async setup(a){let l,o;const s=a,{current:r}=q,{options:d,load:t}=k,{getMarkModels:i,load:c}=U,{options:$,load:F}=ee,{options:E,load:P}=le,{options:A,load:T}=I,{atMountedCarForm:O,carFields:z,theSelectedCarMark:D,v$:H,routeInstance:L}=W(s.inModal),N=({id:e,name:a})=>({value:e,label:a}),R=e((()=>i(D.value).map(N)));[l,o]=u((()=>Promise.all([t(),c(),F(),P(),T({department_id:s.inModal?r.value:void 0}),O(s.inModal)]))),l=await l,o();const Y=n();m(Y,(e=>{var a;z.engine_volume_id=null==(a=$.value[e])?void 0:a.value})),p((()=>{Y.value=$.value.findIndex((({value:e})=>z.engine_volume_id==e))}));const{render:G}=C("#sto-modal-upper",(e=>{var a;z.car_model_id=null==(a=e.car_model)?void 0:a.id})),{render:J}=B("#sto-modal-upper",(e=>{var a;D.value=null==(a=e.car_mark)?void 0:a.id}));return(e,a)=>{var l,o,s,r,n,t,i;return v(),f("div",oe,[_("div",se,[b(M,{disabled:null==(o=null==(l=g(L))?void 0:l.query)?void 0:o.client_id,label:"Владелец",options:g(A),modelValue:g(z).client_id,"onUpdate:modelValue":a[0]||(a[0]=e=>g(z).client_id=e),required:!0,error:null==(s=g(H).client_id.$errors[0])?void 0:s.$message,onBlured:g(H).client_id.$touch},null,8,["disabled","options","modelValue","error","onBlured"])]),_("div",re,[b(X,{label:"Вин номер",modelValue:g(z).vin,"onUpdate:modelValue":a[1]||(a[1]=e=>g(z).vin=e),required:!0,error:null==(r=g(H).vin.$errors[0])?void 0:r.$message,onInput:g(H).vin.$touch,mask:"XXXXXXXXXXXXXXXXXXXX"},null,8,["modelValue","error","onInput"])]),_("div",ne,[b(X,{label:"Гос номер",modelValue:g(z).number,"onUpdate:modelValue":a[2]||(a[2]=e=>g(z).number=e)},null,8,["modelValue"])]),_("div",de,[b(X,{label:"Год выпуска",type:"number",min:1950,max:(new Date).getFullYear(),mask:"####",step:2,modelValue:g(z).year,"onUpdate:modelValue":a[3]||(a[3]=e=>g(z).year=e),error:null==(n=g(H).year.$errors[0])?void 0:n.$message,onInput:g(H).year.$touch},null,8,["max","modelValue","error","onInput"])]),_("div",te,[b(S,{onBottomTouched:a[4]||(a[4]=()=>{}),label:"Марка",options:g(d),modelValue:g(D),"onUpdate:modelValue":a[5]||(a[5]=e=>y(D)?D.value=e:null),class:"flex-grow mr-1"},null,8,["options","modelValue"]),b(g(V),{class:"w-6 text-gray-600 cursor-pointer hover:text-gray-800",onClick:a[6]||(a[6]=()=>g(J)())})]),_("div",ie,[b(M,{label:"Модель",disabled:!g(D),options:g(R),modelValue:g(z).car_model_id,"onUpdate:modelValue":a[7]||(a[7]=e=>g(z).car_model_id=e),required:!0,error:null==(t=g(H).car_model_id.$errors[0])?void 0:t.$message,onBlured:g(H).car_model_id.$touch,class:"flex-grow mr-1"},null,8,["disabled","options","modelValue","error","onBlured"]),b(g(V),{class:"w-6 text-gray-600 cursor-pointer hover:text-gray-800",onClick:a[8]||(a[8]=()=>g(G)())})]),_("div",ce,[b(X,{label:"Кузов",modelValue:g(z).body,"onUpdate:modelValue":a[9]||(a[9]=e=>g(z).body=e)},null,8,["modelValue"])]),_("div",ue,[me,_("div",pe,[_("span",ve,w(null==(i=g($)[g(Y)])?void 0:i.label),1),_("span",fe,[x(_("input",{class:"w-full",id:"engine-volume",type:"range",max:g($).length-1,"onUpdate:modelValue":a[10]||(a[10]=e=>y(Y)?Y.value=e:null)},null,8,_e),[[h,g(Y)]])])])]),_("div",be,[b(M,{label:"Топливо",options:g(E),modelValue:g(z).fuel_id,"onUpdate:modelValue":a[11]||(a[11]=e=>g(z).fuel_id=e)},null,8,["options","modelValue"])]),_("div",ge,[b(X,{label:"Цвет",modelValue:g(z).color,"onUpdate:modelValue":a[12]||(a[12]=e=>g(z).color=e)},null,8,["modelValue"])]),_("div",ye,[b(j,{label:"Примечание",modelValue:g(z).notes,"onUpdate:modelValue":a[13]||(a[13]=e=>g(z).notes=e)},null,8,["modelValue"])])])}}};export{Ve as _,W as c};
