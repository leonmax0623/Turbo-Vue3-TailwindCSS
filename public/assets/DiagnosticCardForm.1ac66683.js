import{S as e,H as a,r as t,I as o,o as r,d as s,e as l,n as d,j as i,u as n,az as c,au as u,V as m,W as p,X as v,f as g,g as b,h as f,aL as y,J as h,ag as _,av as j,ar as x,aM as w,l as V,t as k,v as $,a2 as D,aN as C}from"./vendor.36c281f3.js";import{_ as E}from"./Office.55bfbecd.js";import{_ as I}from"./Button.4b020695.js";import{s as U}from"./useAvatar.7737e550.js";import{$ as O}from"./drop.cce90c26.js";import{s as P}from"./diagnostic-card.03bcc5f0.js";import{a as A,_ as L}from"./index.8fc70fb6.js";import{d as M}from"./process.a2988830.js";import{u as T}from"./useSuspense.29183c13.js";import{_ as B}from"./Input.b03a61c6.js";import{_ as F}from"./DiagnosticCardPreview.d449045c.js";import{u as S}from"./useConfirmDialog.ba73d887.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./departments.4f88a00d.js";import"./meta.48f5205a.js";import"./Spinner.2e0ab286.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./Dialog.b36041f9.js";const{drop:N}=P;let R,z,q;const H=()=>{z=void 0,R=void 0,q=void 0},J=function(e){z.id=this.id,z.title=this.title,R.value=this.data};var W=()=>e().run((()=>{const{back:e,isThePage:r,route:s}=A("DiagnosticCardEdit");z||(z=a({id:"",title:""}),R=t([]),q=o(M(),z,{$lazy:!0}));return{dc_template:z,atMounted:async()=>{var e;if(console.log(null==z?void 0:z.id),(!(null==(e=null==R?void 0:R.value)?void 0:e.length)||!(null==z?void 0:z.title))&&r.value){const{id:e}=s.params;if(e){((e={})=>{Object.getOwnPropertyNames(z).forEach(J,e)})(await O.map(e))}}},isUpdate:r,saveForm:async()=>{z.data=R.value;if(!(await q.value.$validate()))return;q.value.$reset();const{success:a}=await U.map(z,void 0,!0);try{return{success:a}}finally{a&&e()}},dropDc:async()=>{const{success:a,message:t}=await N(s.params.id);return a&&e(),{success:a,message:t}},v$:q,clearMemory:H,fields:R}}));const X={class:"mx-auto flex items-center justify-center border-t border-dashed border-gray-400 relative my-6"},G={class:"flex items-center justify-center rounded-md shadow border-dashed border border-gray-400 cursor-pointer -mt-4"},K=[l("p",null,"Чекпоинт",-1)],Q=[l("p",null,"Текстовое поле",-1)],Y=[l("p",null,"Показания",-1)],Z={props:{modelValue:{type:[String,void 0]}},setup:e=>(a,t)=>(r(),s("div",X,[l("div",G,[l("span",{class:d(["sto-w-200 text-sm text-center transition-colors duration-200 ease-in rounded-l-md py-1 px-6","check_list"==e.modelValue?"bg-blue-200 hover:bg-blue-300":"bg-gray-100 hover:bg-gray-200"]),onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue","check_list"))},K,2),l("span",{class:d(["sto-w-200 text-sm text-center transition-colors duration-200 ease-in py-1 px-6 border-r border-l border-gray-400 border-dashed","text"==e.modelValue?"bg-blue-200 hover:bg-blue-300":"bg-gray-100 hover:bg-gray-200"]),onClick:t[1]||(t[1]=e=>a.$emit("update:modelValue","text"))},Q,2),l("span",{class:d(["sto-w-200 text-sm text-center transition-colors duration-200 ease-in rounded-r-md py-1 px-6","indication"==e.modelValue?"bg-blue-200 hover:bg-blue-300":"bg-gray-100 hover:bg-gray-200"]),onClick:t[2]||(t[2]=e=>a.$emit("update:modelValue","indication"))},Y,2)]),i(n(c),{onClick:t[3]||(t[3]=e=>a.$emit("fieldDropped")),class:"w-8 h-8 absolute left-0 -top-4 hover:shadow-lg shadow-md rounded-full bg-gray-300 text-gray-800 hover:bg-gray-400 hover:text-gray-50 transition-colors duration-200 ease-in cursor-pointer p-1"})]))},ee={class:"grid grid-cols-12 gap-6"},ae={class:"col-span-6 sm:col-span-6"},te={class:"border my-3 col-span-12 bg-gray-50 rounded p-6"},oe={class:"mx-auto flex items-center justify-center border-t border-dashed border-gray-400 my-16"},re={async setup(e){let a,t;const{dc_template:o,atMounted:d,v$:c,fields:h}=W(),_={check_list:{code:1,comp:u((()=>L((()=>import("./CheckList.00e934f2.js")),["assets/CheckList.00e934f2.js","assets/CheckList.7ceae174.css","assets/vendor.36c281f3.js","assets/vuedraggable.umd.d6640c54.js","assets/Item.bfcd9c2e.js","assets/Item.b0c6651b.css","assets/useAvatar.7737e550.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css"])))},text:{code:2,comp:u((()=>L((()=>import("./Text.720f5290.js")),["assets/Text.720f5290.js","assets/Item.bfcd9c2e.js","assets/Item.b0c6651b.css","assets/vendor.36c281f3.js"])))},indication:{code:3,comp:u((()=>L((()=>import("./Indication.741bbce0.js")),["assets/Indication.741bbce0.js","assets/Item.bfcd9c2e.js","assets/Item.b0c6651b.css","assets/vendor.36c281f3.js","assets/useAvatar.7737e550.js","assets/index.8fc70fb6.js","assets/index.4a2793ba.css"])))}},j=()=>{let e=`${h.value.length}-${Date.now()}`;h.value.push({token:e})};return[a,t]=m((()=>d())),a=await a,t(),(e,a)=>{var t;return r(),s("div",ee,[l("div",ae,[i(B,{label:"Название",modelValue:n(o).title,"onUpdate:modelValue":a[0]||(a[0]=e=>n(o).title=e),required:!0,error:null==(t=n(c).title.$errors[0])?void 0:t.$message,onBlured:n(c).title.$touch},null,8,["modelValue","error","onBlured"])]),l("div",te,[(r(!0),s(p,null,v(n(h),((e,a)=>(r(),s("div",{key:`block-${a}`,class:"mb-20"},[i(Z,{modelValue:n(h)[a].type,"onUpdate:modelValue":e=>n(h)[a].type=e,onFieldDropped:()=>{n(h).splice(a,1)}},null,8,["modelValue","onUpdate:modelValue","onFieldDropped"]),n(h)[a].type?(r(),g(b(_[n(h)[a].type].comp),{key:0,modelValue:n(h)[a].data,"onUpdate:modelValue":e=>n(h)[a].data=e},null,8,["modelValue","onUpdate:modelValue"])):f("",!0)])))),128)),l("div",oe,[i(n(y),{onClick:j,class:"mx-auto w-8 h-8 -mt-4 hover:shadow-lg shadow-md rounded-full bg-gray-300 text-gray-800 hover:bg-gray-400 hover:text-gray-50 transition-colors duration-200 ease-in cursor-pointer p-1"})])])])}}},se=V("Вернуться "),le=V("Сохранить "),de=V("Удалить "),ie={setup(e){const{drop:a}=S(),o=T(),{isUpdate:s,saveForm:l,dropDc:d,clearMemory:c,dc_template:u,fields:m}=W(),p=t(!1);return _(c),(e,t)=>{var c;return r(),g(E,{title:`${n(s)?`Обновить шаблон (${null==(c=n(u))?void 0:c.title})`:"Создать шаблон"} ${p.value?"- Предварительный просмотр":""}`},{actions:h((()=>[i(I,{type:"secondary",link:{name:"DiagnosticCard"}},{default:h((()=>[i(n(j),{class:"w-5 h-5 mr-1"}),se])),_:1}),i(I,{color:"blue",onClick:t[0]||(t[0]=e=>p.value=!p.value)},{default:h((()=>[(r(),g(b(p.value?n(x):n(w)),{class:"w-5 h-5 mr-1"})),V(" "+k(p.value?"Редактировать":"Предварительный просмотр"),1)])),_:1}),i(I,{color:"green",onClick:t[1]||(t[1]=()=>n(l)())},{default:h((()=>[i(n($),{class:"w-5 h-5 mr-1"}),le])),_:1}),n(s)?(r(),g(I,{key:0,color:"red",onClick:t[2]||(t[2]=()=>n(a)(n(d)))},{default:h((()=>[i(n(D),{class:"w-5 h-5 mr-1"}),de])),_:1})):f("",!0)])),default:h((()=>[p.value?(r(),g(F,{key:0,fields:n(m),dc_template:n(u),"no-head":!0},null,8,["fields","dc_template"])):(r(),g(n(o),{key:1},{default:h((()=>[(r(),g(C,null,[(r(),g(b(re)))],1024))])),_:1}))])),_:1},8,["title"])}}};export{ie as default};
