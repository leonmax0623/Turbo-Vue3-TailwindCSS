var a=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,l=(e,r,o)=>r in e?a(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,n=(a,e)=>{for(var r in e||(e={}))s.call(e,r)&&l(a,r,e[r]);if(o)for(var r of o(e))t.call(e,r)&&l(a,r,e[r]);return a};import{H as d,a as c,V as i,o as m,d as u,j as p,u as f,S as v,c as _,I as w,ag as g}from"./vendor.36c281f3.js";import{c as b,s as y}from"./useAvatar.7737e550.js";import{$ as j,_ as k}from"./drop.cce90c26.js";import{c as $,b as M}from"./index.8fc70fb6.js";import{_ as O}from"./Input.b03a61c6.js";import{_ as V}from"./Select.bf4a4e1e.js";import{u as B}from"./useModalForm.1c23c14e.js";import{f as I}from"./carModel.5c695b93.js";import{s as P}from"./marks.50b903c7.js";const h=$("crud car models"),F=d({raw:[],pages:100,page:1,pending:!1});var S={state:c(F),reset:()=>{F.raw=[],F.pages=100,F.page=1},load:async()=>{h&&(F.raw=await j.car_models())},drop:async a=>k.car_model(a,(a=>{F.raw.deleteById(a)})),fill:async a=>{var o,s,t;if(F.pending)return;if(!h)return;if(F.page>F.pages)return;F.pending=!0;const l=await j({key:"car_models",params:(d=n({},a),c={page:F.page},e(d,r(c)))});var d,c;F.raw=F.raw.concat(null!=(o=null==l?void 0:l.car_models)?o:[]),F.pages=null!=(t=null==(s=null==l?void 0:l.meta)?void 0:s.last_page)?t:100,F.page+=1,F.pending=!1},add:a=>{const e=F.raw.findIndex((({id:e})=>(null==a?void 0:a.id)==e));e<0?F.raw.push(a):F.raw[e]=a},getMarkModels:a=>a?F.raw.filter((({car_mark:e})=>(null==e?void 0:e.id)===Number(a))):F.raw};const x={async setup(a){let e,r;const{options:o,load:s}=P,{carModel:t,atMountedCarModelsForm:l,v$:n}=A();return[e,r]=i((()=>(async()=>{await s(),await l()})())),e=await e,r(),(a,e)=>{var r,s;return m(),u("div",null,[p(O,{label:"Hазвание модели автомобиля",modelValue:f(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>f(t).name=a),required:!0,error:null==(r=f(n).name.$errors[0])?void 0:r.$message,onBlured:f(n).name.$touch,class:"mb-3"},null,8,["modelValue","error","onBlured"]),p(V,{label:"марка автомобиля",modelValue:f(t).car_mark_id,"onUpdate:modelValue":e[1]||(e[1]=a=>f(t).car_mark_id=a),options:f(o),required:!0,error:null==(s=f(n).car_mark_id.$errors[0])?void 0:s.$message,onBlured:f(n).car_mark_id.$touch},null,8,["modelValue","options","error","onBlured"])])}}},{add:C}=S,q=M();let H,U;const z=async()=>{const{id:a}=U;if(a){((a={})=>{var e;U.id=a.id,U.name=a.name,U.car_mark_id=null==(e=a.car_mark)?void 0:e.id})(await j.car_model(a))}};function A(a,e=(()=>{})){return{render:(...r)=>{const o=v();o.run((()=>{const s=_((()=>!!U.id)),{render:t}=B({title:_((()=>b.modal[s.value?"update":"create"].car_model)),RawForm:x,mount_point:a,atSubmit:async()=>{const{data:a}=await(async()=>{if(!(await H.value.$validate()))return;H.value.$reset();const{message:a,success:e,data:r}=await y.car_model(U);try{return{message:a,success:e,data:r}}finally{e&&(C(r.car_model),q.success(a))}})();return e&&e(a),a},atClose:()=>o.stop(),atOpen:a=>{U=d({id:null!=a?a:"",name:"",car_mark_id:""}),H=w(I(),U,{$lazy:!0})}});t(...r),g((()=>{U=void 0,H=void 0}))}))},atMountedCarModelsForm:z,carModel:U,v$:H}}export{A as c,S as s};
