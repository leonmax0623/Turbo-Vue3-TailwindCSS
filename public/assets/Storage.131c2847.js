var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,s,l)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,i=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&r(e,s,t[s]);if(l)for(var s of l(t))o.call(t,s)&&r(e,s,t[s]);return e};import{o as n,f as u,j as d,S as c,H as m,c as p,r as f,w as v,V as g,ag as y,d as b,e as x,W as w,X as h,Y as j,u as k,t as _,J as C,h as P,l as q,L as S,M as T,P as V,U as I,av as O,a1 as $,N as A,at as B,aA as F,aQ as R,aR as M}from"./vendor.36c281f3.js";import{_ as H}from"./Office.55bfbecd.js";import{_ as L}from"./Button.4b020695.js";import{_ as U}from"./ButtonGroup.f61666b1.js";import{o as D}from"./useOrder.941ce970.js";import{s as E,a as z}from"./storage-requests.df03da5b.js";import{a as N,b as G}from"./index.8fc70fb6.js";import{_ as J}from"./Link.4e9a6f0f.js";import{_ as K}from"./Table.ec42ea9a.js";import{_ as Q}from"./Badge.4bd69676.js";import{f as W}from"./form.8a1db4fc.js";import{u as X}from"./useIntersectionObserver.7ad3d6a4.js";import{r as Y}from"./CheckIcon.6fe7075c.js";import{r as Z}from"./PencilIcon.e50c0995.js";import{r as ee}from"./PlusIcon.4d23725d.js";import{_ as te}from"./Avatar.4eeca634.js";import{_ as se}from"./TextArea.fcc59b75.js";import{l as le,c as ae,s as oe,g as re}from"./useAvatar.7737e550.js";import{_ as ie}from"./Input.b03a61c6.js";import{_ as ne}from"./Select.bf4a4e1e.js";import{o as ue}from"./orders.a1ebe807.js";import{d as de}from"./departments.4f88a00d.js";import{u as ce}from"./useModalForm.1c23c14e.js";import{u as me}from"./useSuspense.29183c13.js";import{$ as pe}from"./drop.cce90c26.js";import"./headlessui.esm.b519f347.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./meta.48f5205a.js";import"./Th.32cd08d3.js";import"./useConfirmDialog.ba73d887.js";import"./Dialog.b36041f9.js";import"./Spinner.2e0ab286.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./FormActions.47218f8a.js";function fe(e,t){return n(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[d("path",{"fill-rule":"evenodd",d:"M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z","clip-rule":"evenodd"})])}function ve(e,t){return n(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[d("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})])}const{setRequestStatus:ge,state:ye,replace:be}=E,{sort:xe,fill:we,reset:he,getProducts:je,state:ke,dropRequestFromProduct:_e,updateCount:Ce}=z,Pe={id:{label:"По умолчанию",sort:(e,t)=>e.id-t.id},name:{label:"По имени",sort:(e,t)=>e.name>t.name?1:e.name<t.name?-1:0}};let qe,Se,Te;const Ve=()=>{qe=void 0,Se=void 0,Te=void 0},Ie=async(e,t,s="done")=>{const{id:l,count:a}=e;if(!l||!t||!a)return;await ge(l,s)&&(_e(l,t),Ce(t,-a))};var Oe=()=>c().run((()=>{const{redirectTo:e,isThePage:l,route:a}=N("StorageRequests");qe||(qe=m({name:"",sku:"",producer_id:""}),Se=je(l.value),Te=p((()=>{var e;return ke.selectedId&&null!=(e=Se.value.find((({id:e})=>e===ke.selectedId)))?e:{}})));return{order:D(Pe,"id",(e=>{xe(e)}),1),filter:qe,fetchProducts:async(e=!1)=>{var o,r;e&&he(),await we((o=i({},qe),r={storage_id:a.params.id,status:l.value?"wait":void 0},t(o,s(r))))},redirectToForm:async(t,s)=>{var l;let{id:o}=a.params;o||(o=null==(l=s.storage)?void 0:l.id),null!=o&&null!=t&&await e({name:"EditStorage",params:{product:t,id:o}})},isThePage:l,ping:Ie,key:p((()=>ye.raw.length)),replaceInRequests:be,clearMemo:Ve,products:Se,target:Te,selected:p((()=>{var e;return!!(null==(e=null==Te?void 0:Te.value)?void 0:e.id)}))}}));const $e={key:0,class:"flex"},Ae={role:"list",class:"w-full grid grid-cols-2 gap-x-4 gap-y-8 sm:grid-cols-3 sm:gap-x-6 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8"},Be={class:"group block w-full aspect-w-10 aspect-h-7 rounded-lg bg-gray-100 focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-offset-gray-100 focus-within:ring-indigo-500 overflow-hidden"},Fe=["onClick"],Re={class:"sr-only"},Me={class:"p-4"},He=q("Запрошено"),Le={class:"flex items-center justify-between flex-wrap"},Ue={class:"mb-1 mt-2 block text-sm font-medium text-gray-900 truncate pointer-events-none"},De={class:"mb-1 text-sm font-medium text-gray-500 pointer-events-none"},Ee={class:"mb-1 block text-sm font-medium text-gray-500 pointer-events-none"},ze={props:{grid:Boolean,search:String},emits:["bottomTouched"],async setup(e,{emit:t}){let s,l;const a=e,{select:o,reset:r}=z,{dropProduct:i,defaults:c}=W(),{fetchProducts:m,redirectToForm:S,isThePage:T,products:V}=Oe(),I=f([]);v([V,()=>a.search],(([e,t])=>{if(t){const e=t.toLowerCase();I.value=V.value.filter((({name:t,description:s})=>t.toLowerCase().includes(e)||s.toLowerCase().includes(e)))}else I.value=V.value}),{immediate:!0});const{pixel:O,container:$}=X((()=>t("bottomTouched")),f,p((()=>{var e;return(null==(e=null==V?void 0:V.value)?void 0:e.length)>0}))),A=[{label:"Название",key:"name"},{label:"Количество",key:"count"},{label:"Артикул",key:"sku"},{label:"Место",key:"place"}];return[s,l]=g((()=>m(!0))),s=await s,l(),y((()=>r(!0))),(t,s)=>(n(),b("div",{class:"pt-5 pb-1 px-3 lg:px-5",ref:e=>$.value=e},[e.grid?(n(),b("div",$e,[x("ul",Ae,[(n(!0),b(w,null,h(I.value,(e=>{var t;return n(),b("li",{key:`${e.id}-${e.count}`,class:"relative shadow-md"},[x("div",Be,[x("div",{style:j(`background-image: url(${null!=(t=e.photo)?t:k(c).photo});`),class:"w-full h-full bg-center bg-no-repeat bg-cover shadow-sm cursor-pointer group-hover:opacity-75 transition-opacity duration-300 ease-in"},null,4),x("button",{type:"button",class:"absolute inset-0 focus:outline-none",onClick:()=>k(o)(e.id)},[x("span",Re,"Посмотреть "+_(e.name),1)],8,Fe)]),x("div",Me,[k(T)?(n(),u(Q,{key:0,point:!0,color:"yellow"},{default:C((()=>[He])),_:1})):P("",!0),x("div",Le,[x("p",Ue,_(e.name),1),x("p",De,"Артикул: "+_(null==e?void 0:e.sku),1)]),(n(),b("p",{key:e.count,class:"mb-1 block text-sm font-medium text-gray-500 pointer-events-none"},"В наличии: "+_(e.count),1)),x("p",Ee,"Место: "+_(e.place),1)])])})),128))])])):(n(),u(K,{key:1,fields:A,items:I.value,onDelete:s[0]||(s[0]=e=>k(i)(e)),onEdit:s[1]||(s[1]=e=>k(S)(e))},{"td-name":C((({value:e,item:{id:t}})=>[d(J,{onClick:()=>k(o)(t)},{default:C((()=>[q(_(e),1)])),_:2},1032,["onClick"])])),"td-count":C((({value:e})=>[x("p",null,_(e),1)])),"td-sku":C((({value:e})=>[x("p",null,_(e),1)])),"td-place":C((({value:e})=>[q(_(e),1)])),_:1},8,["items"])),d(k(O))],512))}},Ne={async setup(e){let t,s;const{products_request:l}=Qe(),{loadStatuses:a,state:o}=E,{load:r,options:i}=ue,{current:u}=de;let c;return[t,s]=g((()=>Promise.all([a(),r({department_id:u.value})]).then((()=>{c=o.statuses.map((e=>({label:le[e].label,value:e})))})))),t=await t,s(),(e,t)=>(n(),b("div",null,[d(ne,{label:"Заказ наряда",options:k(i),required:!0,modelValue:k(l).order_id,"onUpdate:modelValue":t[0]||(t[0]=e=>k(l).order_id=e),class:"m-3 sm:col-span-6 col-span-12"},null,8,["options","modelValue"]),d(ie,{label:"Количество",type:"number",required:!0,modelValue:k(l).count,"onUpdate:modelValue":t[1]||(t[1]=e=>k(l).count=e),class:"m-3 sm:col-span-6 col-span-12"},null,8,["modelValue"]),d(ne,{label:"Статус",options:k(c),required:!0,modelValue:k(l).status,"onUpdate:modelValue":t[2]||(t[2]=e=>k(l).status=e),class:"m-3 sm:col-span-6 col-span-12"},null,8,["options","modelValue"])]))}},{addProductRequest:Ge}=z,Je=G();let Ke;function Qe(){return{render:(...e)=>{const t=c();t.run((()=>{const s=p((()=>!!Ke.id)),{render:l}=ce({title:p((()=>ae.modal[s.value?"update":"create"].products_request)),RawForm:Ne,atSubmit:()=>(async()=>{var e;const{message:t,success:s,data:l}=await oe.products_request(Ke);try{return{message:t,success:s}}finally{if(s&&(Je.success(t),(null==l?void 0:l.product_request)&&"wait"===(null==(e=null==l?void 0:l.product_request)?void 0:e.status))){const{product_request:e}=l,{product:t}=e;delete e.product,Ge(null==t?void 0:t.id,e)}}})(),atClose:()=>t.stop(),atOpen:e=>{Ke=m({status:"",count:"",order_id:"",product_id:e})}});l(...e),y((()=>{Ke=void 0}))}))},products_request:Ke}}S("data-v-cadebe70");const We={class:"hidden w-96 bg-white px-8 border-l border-gray-200 overflow-y-auto lg:block"},Xe={class:"pb-16 space-y-6"},Ye={class:"block w-full aspect-w-10 aspect-h-7 rounded-lg overflow-hidden"},Ze=["src"],et={class:"mt-4 flex items-start justify-between"},tt={class:"text-lg font-medium text-gray-900"},st={class:"text-sm font-medium text-gray-500"},lt=x("h3",{class:"font-medium text-gray-900"},"Информация",-1),at={class:"mt-2 border-t border-b border-gray-200 divide-y divide-gray-200"},ot={class:"py-3 flex justify-between text-sm font-medium"},rt=x("dt",{class:"text-gray-500"},"Добавил",-1),it={class:"text-gray-900"},nt={class:"py-3 flex justify-between text-sm font-medium"},ut=x("dt",{class:"text-gray-500"},"Дата добавления",-1),dt={class:"text-gray-900"},ct={class:"py-3 flex justify-between text-sm font-medium"},mt=x("dt",{class:"text-gray-500"},"Дата изменения",-1),pt={class:"text-gray-900"},ft={class:"py-3 flex justify-between text-sm font-medium"},vt=x("dt",{class:"text-gray-500"},"Стоимость закупки",-1),gt={class:"text-gray-900"},yt={class:"py-3 flex justify-between text-sm font-medium"},bt=x("dt",{class:"text-gray-500"},"Стоимость продажи",-1),xt={class:"text-gray-900"},wt={class:"py-3 flex justify-between text-sm font-medium"},ht=x("dt",{class:"text-gray-500"},"Артикул",-1),jt={class:"text-gray-900"},kt=x("h3",{class:"font-medium text-gray-900"},"Описание",-1),_t={class:"mt-2 flex items-center justify-between mb-2"},Ct={class:" flex items-center justify-end"},Pt={key:0,class:"font-medium text-gray-900"},qt={class:"mb-2 flex justify-between items-center"},St=["onClick"],Tt={class:"flex justify-between items-center mb-2"},Vt={class:"text-xs"},It={class:"text-xs"},Ot={key:0,class:"text-xs"},$t={class:"py-2 flex justify-between items-center"},At={class:"w-8 h-8 rounded-full border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400"},Bt=x("span",{class:"ml-4 text-sm font-medium text-indigo-600 group-hover:text-indigo-500"},"Добавить выдачу",-1),Ft={class:"flex justify-between"},Rt=q("Изменить"),Mt=q("Удалить");T();const Ht={setup(e){const{redirectToForm:t,isThePage:s,ping:l,key:a,replaceInRequests:o,target:r}=Oe(),{render:c}=Qe(),m=p((()=>{var e,t;return null==(t=null==(e=r.value)?void 0:e.product_requests)?void 0:t.filter((({status:e})=>"wait"===e))})),{dropProduct:g,defaults:y}=W(),{select:j,replace:q}=z,S=f(!1),T=f(""),I=f(!1),O=()=>{T.value=r.value.description};v(r,O);const $=()=>{S.value=!1},A=async()=>{if(!I.value)if(S.value){await(async()=>{if(!T.value)return!0;if(T.value===r.value.description)return!0;I.value=!0;try{const e=i({},r.value);e.description=T.value;const{data:t,success:l}=await oe.product(e,null,!0);return l&&(s.value?o:q)(null==t?void 0:t.product),l}finally{I.value=!1}})()&&$()}else S.value=!0,O()};return V((()=>{$(),O()})),(e,o)=>{var i,p,f,v,q,V,$,B,F;return n(),b("aside",We,[x("div",null,[x("button",{onClick:o[0]||(o[0]=()=>k(j)()),type:"button",class:"my-4 mx-auto bg-white rounded-full h-8 w-8 flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},[d(k(fe),{class:"h-5 w-5"})])]),x("div",Xe,[x("div",null,[x("div",Ye,[x("img",{src:null!=(i=k(r).photo)?i:k(y).photo,class:"object-cover"},null,8,Ze)]),x("div",et,[x("div",null,[x("h2",tt,_(k(r).name),1),(n(),b("p",{key:k(r).count,class:"text-sm font-medium text-gray-500"},"В наличии: "+_(k(r).count)+" шт",1)),x("p",st,"Место: "+_(k(r).place),1)])])]),x("div",null,[lt,x("dl",at,[x("div",ot,[rt,x("dd",it,_(`${null!=(f=null==(p=k(r).user)?void 0:p.name)?f:""} ${null!=(q=null==(v=k(r).user)?void 0:v.surname)?q:""}`),1)]),x("div",nt,[ut,x("dd",dt,_(null==(V=k(r).created_at)?void 0:V.split(" ")[0]),1)]),x("div",ct,[mt,x("dd",pt,_(null==($=k(r).updated_at)?void 0:$.split(" ")[0]),1)]),x("div",ft,[vt,x("dd",gt,_(k(r).input_sum)+" ₽",1)]),x("div",yt,[bt,x("dd",xt,_(k(r).output_sum)+" ₽",1)]),x("div",wt,[ht,x("dd",jt,_(k(r).sku),1)])])]),x("div",null,[kt,x("div",null,[x("div",_t,[(n(),b("p",{class:"text-sm text-gray-500 italic ml-1",key:k(r).description},_(T.value?`${T.value.substr(0,23)}...`:"Добавить описание"),1)),x("div",Ct,[S.value?(n(),b("button",{key:0,onClick:O,type:"button",class:"mr-2 bg-white rounded-full h-8 w-8 flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},[d(k(ve),{class:"h-5 w-5"})])):P("",!0),I.value?P("",!0):(n(),b("button",{key:1,onClick:o[1]||(o[1]=()=>A()),type:"button",class:"bg-white rounded-full h-8 w-8 flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},[S.value?(n(),u(k(Y),{key:0,class:"h-5 w-5"})):(n(),u(k(Z),{key:1,class:"h-5 w-5"}))]))])]),S.value?(n(),u(se,{key:0,rows:"7",modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=e=>T.value=e)},null,8,["modelValue"])):P("",!0)])]),x("div",null,[(null==(B=k(m))?void 0:B.length)?(n(),b("h3",Pt,"Запросили")):P("",!0),(null==(F=k(m))?void 0:F.length)?(n(),b("ul",{class:"mt-2 border-t border-b border-gray-200 divide-y divide-gray-200",key:`${k(a)}-${k(m).length}-requests`},[(n(!0),b(w,null,h(k(m),(e=>{var t,s,a,o,i,u;return n(),b("li",{key:e.id,class:"py-3"},[x("div",qt,[d(te,{image:null==(t=null==e?void 0:e.user)?void 0:t.avatar,title:`${null!=(a=null==(s=null==e?void 0:e.user)?void 0:s.name)?a:""} ${null!=(i=null==(o=null==e?void 0:e.user)?void 0:o.surname)?i:""}`,subtitle:null==(u=null==e?void 0:e.user)?void 0:u.office_position},null,8,["image","title","subtitle"]),x("button",{onClick:()=>{var t;return k(l)(e,null==(t=k(r))?void 0:t.id)},type:"button",class:"ml-6 bg-white rounded-md text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"Выдать",8,St)]),x("div",Tt,[x("p",Vt,"Заказ-наряд: "+_(null!=(null==e?void 0:e.order_id)?`#${k(re)(null==e?void 0:e.order_id)}`:""),1),x("p",It,"Kоличество: "+_(null==e?void 0:e.count),1)]),(null==e?void 0:e.sum)?(n(),b("p",Ot,"Цена продажи: "+_(null==e?void 0:e.sum)+" ₽",1)):P("",!0)])})),128))])):P("",!0),x("div",$t,[x("button",{onClick:o[3]||(o[3]=()=>{var e;return k(c)(null==(e=k(r))?void 0:e.id)}),type:"button",class:"flex-grow group -ml-1 bg-white p-1 rounded-md flex items-center focus:outline-none focus:ring-2 focus:ring-indigo-500"},[x("span",At,[d(k(ee),{class:"h-5 w-5"})]),Bt])])]),x("div",Ft,[d(L,{color:"blue",class:"flex-1 justify-center",onClick:o[4]||(o[4]=()=>k(t)(k(r).id,k(r)))},{default:C((()=>[Rt])),_:1}),d(L,{color:"red",class:"flex-1 ml-3 justify-center",onClick:o[5]||(o[5]=()=>k(g)(k(r).id,k(s)))},{default:C((()=>[Mt])),_:1})])])])}},__scopeId:"data-v-cadebe70"},Lt=q("Назад "),Ut=q("Добавить позицию "),Dt={class:"flex-1 flex items-stretch overflow-hidden"},Et={class:"flex-1 overflow-y-auto"},zt={class:"justify-between flex px-3 lg:px-5 mt-4"},Nt={class:"flex items-stretch gap-3"},Gt=q("В наличии "),Jt=q("Нет в наличии "),Kt={class:"flex"},Qt={setup(e){const{setAvailability:t,state:s}=z,l=me(),{fetchProducts:a,isThePage:o,clearMemo:r,selected:i}=Oe(),{route:c}=N(),m=f(!0),p=f(),v=I("");return V((async()=>{var e;p.value=o.value?"Запрошенные запчасти":null==(e=await pe.storage(c.params.id))?void 0:e.name})),y(r),(e,r)=>(n(),u(H,{title:`${p.value} ${k(s).pending?" загрузка...":""}`,"main-classes":"flex-1 flex flex-col overflow-hidden"},{actions:C((()=>{var e;return[d(L,{type:"secondary",link:{name:"Storages"}},{default:C((()=>[d(k(O),{class:"w-5 h-5 mr-1"}),Lt])),_:1}),k(o)?P("",!0):(n(),u(L,{key:0,color:"blue",link:{name:"StorageForm",params:{id:null==(e=k(c).params)?void 0:e.id}}},{default:C((()=>[d(k($),{class:"w-5 h-5 mr-1"}),Ut])),_:1},8,["link"]))]})),content:C((()=>[x("div",Dt,[x("div",Et,[x("div",zt,[x("div",Nt,[d(U,{key:k(s).inStock?"inStock":"notInStock"},{default:C((()=>[d(L,{type:k(s).inStock?"primary":"secondary",onClick:r[0]||(r[0]=()=>k(t)(!0)),group:"left"},{default:C((()=>[Gt])),_:1},8,["type"]),d(L,{type:k(s).inStock?"secondary":"primary",onClick:r[1]||(r[1]=()=>k(t)()),group:"right"},{default:C((()=>[Jt])),_:1},8,["type"])])),_:1}),A(x("input",{type:"text",class:"rounded h-full",placeholder:"Поиск ...","onUpdate:modelValue":r[2]||(r[2]=e=>F(v)?v.value=e:null)},null,512),[[B,k(v)]])]),x("div",Kt,[d(U,{key:m.value?"grid":"list"},{default:C((()=>[d(L,{type:m.value?"primary":"secondary",onClick:r[3]||(r[3]=e=>m.value=!0),group:"left"},{default:C((()=>[d(k(R),{class:"w-5 h-5 mr-1"})])),_:1},8,["type"]),d(L,{type:m.value?"secondary":"primary",onClick:r[4]||(r[4]=e=>m.value=!1),group:"right"},{default:C((()=>[d(k(M),{class:"w-5 h-5 mr-1"})])),_:1},8,["type"])])),_:1})])]),d(k(l),{loadingMsg:"получение товаров..."},{default:C((()=>[d(ze,{grid:m.value,onBottomTouched:r[5]||(r[5]=()=>k(a)()),search:k(v)},null,8,["grid","search"])])),_:1})]),k(i)?(n(),u(Ht,{key:""+(k(o)?"on":"off")})):P("",!0)])])),_:1},8,["title"]))}};export{Qt as default};
