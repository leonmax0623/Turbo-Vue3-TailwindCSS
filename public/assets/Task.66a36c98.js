import{S as a,r as s,V as e,o as t,d as l,j as o,aD as i,u as n,J as r,e as d,W as u,X as c,aE as m,t as p,l as v,h as f,f as k,aF as h,n as b,ag as _,av as x,v as j,ar as g}from"./vendor.36c281f3.js";import{_ as y}from"./Office.55bfbecd.js";import{_ as w}from"./Button.4b020695.js";import{u as C}from"./useSuspense.29183c13.js";import{_ as T}from"./Card.9a20a748.js";import{_ as M}from"./Avatar.4eeca634.js";import{_ as B}from"./Checkbox.452236a5.js";import{_ as V}from"./Badge.4bd69676.js";import $ from"./Comments.ea5d3474.js";import{a as D,s as A,h as E,l as S}from"./useAvatar.7737e550.js";import{a as H,f as I,b as L}from"./index.8fc70fb6.js";import{$ as U}from"./drop.cce90c26.js";import{_ as F}from"./DiagnosticCardPreview.d449045c.js";import"./headlessui.esm.b519f347.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./Input.b03a61c6.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./departments.4f88a00d.js";import"./meta.48f5205a.js";import"./Spinner.2e0ab286.js";import"./TextArea.fcc59b75.js";const J=L();let N;var O=()=>a().run((()=>{const{route:a,back:e}=H();N||(N=s({}));const t=D((async(a,s,e)=>{const{success:t,message:l}=await A({path:`tasks/checkboxes/${a}/status`,data:{is_checked:s}});t||(J.danger(null!=l?l:"Не удалось изменить статус флажка"),N.value.checkboxes[e].is_checked=!s)})),l=a.params.id;return{canTasks:I,task:N,atMounted:async()=>{const{id:s}=a.params;N.value=await U.task(s),N.value.id||e()},checkBox:t,back:e,route:a,ping:async a=>{var s;const e=`tasks/${l}/to/${a?"process":"done"}`,{success:t,message:o,data:i}=await A({path:e,data:{[(a?"start":"end")+"_at"]:E(new Date)}});t&&(N.value.status=null==(s=null==i?void 0:i.task)?void 0:s.status);const n=null!=o?o:t?"Статус успешно изменен":"Не удалось изменить статус задача";J[t?"success":"danger"](n)},task_id:l,clearMemo:()=>{N=void 0}}}));const P={class:"flex gap-3 flex-wrap justify-between items-center"},W={class:"text-right"},X={class:"text-sm flex items-center mb-3"},q=d("span",{class:"mr-1"},"Крайний срок:",-1),z={class:"text-gray-500"},G=d("h2",{class:"font-bold"},"Прикреплённые файлы",-1),K={class:"mt-2"},Q=["href"],R={key:0},Y=d("h2",{class:"font-bold"},"Текст задачи",-1),Z=["innerHTML"],aa={key:1,class:"mt-4"},sa=d("h2",{class:"font-bold"},"Чек лист",-1),ea={key:0,class:"mt-4 text-sm text-gray-400"},ta={async setup(a){let _,x;const{task:j,atMounted:g,route:y,checkBox:w,canTasks:C}=O(),D=s({});return[_,x]=e((()=>g().then((async()=>{j.value.is_map&&(D.value=await U.map(j.value.task_map.map_id))})))),_=await _,x(),(a,s)=>{var e;return t(),l("div",null,[o(T,null,i({header:r((()=>{var a,s,e,t,l,i,u;return[d("div",P,[o(M,{title:`${null!=(s=null==(a=n(j).author)?void 0:a.name)?s:""} ${null!=(t=null==(e=n(j).author)?void 0:e.middle_name)?t:""}`,subtitle:null==(l=n(j).author)?void 0:l.office_position,image:null==(i=n(j).author)?void 0:i.avatar},null,8,["title","subtitle","image"]),d("div",W,[d("div",X,[o(n(m),{class:"w-4 h-4 mr-1"}),q,d("span",z,p(n(j).deadline_at),1)]),o(V,{point:!0,color:null==(u=n(S)[n(j).status])?void 0:u.color},{default:r((()=>{var a;return[v(p(null==(a=n(S)[n(j).status])?void 0:a.label),1)]})),_:1},8,["color"])])])]})),default:r((()=>{var a,s,e,i,r,m,v,h;return[n(j).is_map?f("",!0):(t(),l("div",R,[Y,d("p",{innerHTML:n(j).description},null,8,Z)])),n(j).is_map?(t(),k(F,{key:2,task_id:n(j).id,map_answer:n(j).map_answer,fields:null!=(h=D.value.data)?h:[],dc_template:D.value,"no-head":!0,disabled:!n(C)(n(j),"update")},null,8,["task_id","map_answer","fields","dc_template","disabled"])):(t(),l("div",aa,[sa,d("ul",null,[(t(!0),l(u,null,c(null!=(a=n(j).checkboxes)?a:[],((a,s)=>(t(),l("li",{key:a.id,class:b(["py-2",{"line-through":a.is_checked}])},[o(B,{disabled:!n(C)(n(j),"update")||"process"!==n(j).status,label:a.description,modelValue:a.is_checked,"onUpdate:modelValue":s=>a.is_checked=s,onClicked:()=>n(w)(a.id,!a.is_checked,s)},null,8,["disabled","label","modelValue","onUpdate:modelValue","onClicked"])],2)))),128))]),(null==(e=null==(s=n(j))?void 0:s.checkboxes)?void 0:e.length)?(t(),l("span",ea," Выполнено: "+p(null==(r=null==(i=n(j))?void 0:i.checkboxes)?void 0:r.filter((a=>a.is_checked)).length)+" из "+p(null==(v=null==(m=n(j))?void 0:m.checkboxes)?void 0:v.length),1)):f("",!0)]))]})),_:2},[(null==(e=n(j).files)?void 0:e.length)&&!n(j).is_map?{name:"footer",fn:r((()=>[G,d("ul",K,[(t(!0),l(u,null,c(n(j).files,(a=>(t(),l("li",{key:a.name,class:"p-3 text-sm border rounded my-2 flex items-center font-medium text-blue-600 hover:text-blue-500"},[o(n(h),{class:"w-4 h-4 mr-1"}),d("a",{href:a.url,target:"_blank"},p(a.name),9,Q)])))),128))])]))}:void 0]),1024),o($,{title:"Комментарии к задаче / Заментки",model:"task",id:n(y).params.id,class:"mt-2",disabled:!n(C)(n(j),"update")},null,8,["id","disabled"])])}}},la=v("Назад "),oa=v("Начать "),ia=v("Завершить "),na=v("Изменить "),ra={setup(a){const{back:s,task_id:e,ping:l,clearMemo:i,task:d,canTasks:u}=O(),c=C(ta);return _(i),(a,i)=>{var p;return t(),k(y,{title:null==(p=n(d))?void 0:p.name},{actions:r((()=>{var a,c,p,v,h,b,_;return[o(w,{type:"secondary",onClick:n(s)},{default:r((()=>[o(n(x),{class:"w-5 h-5 mr-1"}),la])),_:1},8,["onClick"]),"wait"!==(null==(a=n(d))?void 0:a.status)&&"done"!==(null==(c=n(d))?void 0:c.status)&&"pause"!==(null==(p=n(d))?void 0:p.status)||!n(u)(n(d),"update")?f("",!0):(t(),k(w,{key:0,color:"purple",onClick:i[0]||(i[0]=()=>n(l)(!0)),blur:""},{default:r((()=>[o(n(m),{class:"w-5 h-5 mr-1"}),oa])),_:1})),"process"!==(null==(v=n(d))?void 0:v.status)&&(null==(h=n(d))?void 0:h.status)!=("process"===(null==(b=n(d))?void 0:b.status))&&"pause"===(null==(_=n(d))?void 0:_.status)!="pause"||!n(u)(n(d),"update")?f("",!0):(t(),k(w,{key:1,color:"green",onClick:i[1]||(i[1]=()=>n(l)(!1)),blur:""},{default:r((()=>[o(n(j),{class:"w-5 h-5 mr-1"}),ia])),_:1})),n(u)(n(d),"update")?(t(),k(w,{key:2,color:"blue",link:{name:"TaskEdit",params:{id:n(e)}}},{default:r((()=>[o(n(g),{class:"w-5 h-5 mr-1"}),na])),_:1},8,["link"])):f("",!0)]})),default:r((()=>[o(n(c))])),_:1},8,["title"])}}};export{ra as default};
