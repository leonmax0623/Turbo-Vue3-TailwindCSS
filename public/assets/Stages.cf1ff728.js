import{V as e,o as a,d as s,e as r,j as o,u as t,c as l,E as n,F as i,S as d,H as u,I as m,ag as c,f as p,J as f,l as v,t as b,Y as j,r as g,P as _,av as w,a1 as y}from"./vendor.36c281f3.js";import{_ as $}from"./Office.55bfbecd.js";import{_ as h}from"./Button.4b020695.js";import{u as k}from"./useSuspense.29183c13.js";import{_ as V}from"./Link.4e9a6f0f.js";import{u as B}from"./useConfirmDialog.ba73d887.js";import{s as C}from"./stages.b7bebdd4.js";import{_ as M}from"./Table.ec42ea9a.js";import{_ as F}from"./Input.b03a61c6.js";import{c as q,s as x}from"./useAvatar.7737e550.js";import{u as D}from"./useModalForm.1c23c14e.js";import{b as I,a as S}from"./index.8fc70fb6.js";import{$ as A}from"./drop.cce90c26.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./departments.4f88a00d.js";import"./meta.48f5205a.js";import"./Spinner.2e0ab286.js";import"./Dialog.b36041f9.js";import"./index.ce6adbb1.js";import"./Th.32cd08d3.js";import"./useIntersectionObserver.7ad3d6a4.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./FormActions.47218f8a.js";const E={async setup(l){let n,i;const{stage:d,atMounted:u,v$:m}=N();return[n,i]=e((()=>u())),n=await n,i(),(e,l)=>{var n,i;return a(),s("div",null,[r("div",null,[o(F,{label:"Название",modelValue:t(d).name,"onUpdate:modelValue":l[0]||(l[0]=e=>t(d).name=e),required:!0,error:null==(n=t(m).name.$errors[0])?void 0:n.$message,onBlured:t(m).name.$touch},null,8,["modelValue","error","onBlured"])]),r("div",null,[o(F,{label:"Цвет",type:"color",modelValue:t(d).color,"onUpdate:modelValue":l[1]||(l[1]=e=>t(d).color=e),required:!0,error:null==(i=t(m).color.$errors[0])?void 0:i.$message,onBlured:t(m).color.$touch},null,8,["modelValue","error","onBlured"])])])}}};const{add:O}=C,T=I();let U,z,H;const J=async()=>{const{id:e}=U;if(e){const a=await A.stage(e);((e={})=>{U.id=e.id,U.name=e.name,U.color=e.color,U.pipeline_id=e.pipeline_id})(null!=a?a:{})}},L=(...e)=>{const a=d();a.run((()=>{const s=l((()=>!!(null==U?void 0:U.id))),{render:r}=D({title:l((()=>q.modal[s.value?"update":"create"].stage)),RawForm:E,atSubmit:()=>(async()=>{if(!(await H.value.$validate()))return;H.value.$reset();const{message:e,success:a,data:s}=await x.stage(U);try{return{message:e,success:a}}finally{a&&(O(s.stage),T.success(e))}})(),atClose:()=>a.stop(),atOpen:e=>{U=u({id:null!=e?e:"",name:"",color:"",pipeline_id:z}),H=m(l((()=>({name:{required:n.withMessage("Укажите вопрос",i)},color:{required:n.withMessage("Выберите цвет",i)}}))),U,{$lazy:!0})}});r(...e),c((()=>{U=void 0,H=void 0}))}))};function N(e){return e&&(z=e),{stage:U,atMounted:J,render:L,v$:H}}const P={async setup(s){let l,n;const{route:{params:{id:i}}}=S(),{state:d,load:u,drop:m}=C;[l,n]=e((()=>u(i))),l=await l,n();const c=[{label:"Название",key:"name"},{label:"Цвет",key:"color"},{label:"Дата создания",key:"created_at"}],{drop:g}=B(),{render:_}=N();return(e,s)=>(a(),p(M,{fields:c,items:t(d).raw,onDelete:s[0]||(s[0]=e=>t(g)((()=>t(m)(e)))),onEdit:s[1]||(s[1]=e=>t(_)(e))},{"td-name":f((({value:e,item:{id:a}})=>[o(V,{onClick:()=>t(_)(a)},{default:f((()=>[v(b(e),1)])),_:2},1032,["onClick"])])),"td-color":f((({value:e})=>[r("div",{class:"w-9 h-9 border shadow-sm rounded-full",style:j({background:e})},null,4)])),"td-created_at":f((({value:e})=>{var a;return[v(b(null!=(a=null==e?void 0:e.split(" ")[0])?a:"_"),1)]})),_:1},8,["items"]))}},R=v("К воронкам "),Y=v("Создать "),G={setup(e){const{route:{params:{id:s}}}=S(),{render:r}=N(s),l=k(P),n=g();return _((async()=>{n.value=await A.pipeline(s)})),(e,s)=>{var i,d;return a(),p($,{title:`Все этапы ${null!=(d=null==(i=n.value)?void 0:i.name)?d:""}`},{actions:f((()=>[o(h,{type:"secondary",link:{name:"Funnels"}},{default:f((()=>[o(t(w),{class:"w-5 h-5 mr-1"}),R])),_:1}),o(h,{color:"blue",onClick:s[0]||(s[0]=()=>t(r)())},{default:f((()=>[o(t(y),{class:"w-5 h-5 mr-1"}),Y])),_:1})])),default:f((()=>[o(t(l),{loadingMsg:"получение этапов..."})])),_:1},8,["title"])}}};export{G as default};
