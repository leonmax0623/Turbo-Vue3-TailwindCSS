import{V as e,o as s,d as a,e as t,t as o,u as n,S as r,H as i,ag as l,f as p,J as u,j as d,l as c,a8 as m}from"./vendor.36c281f3.js";import{_ as f}from"./Table.ec42ea9a.js";import{_ as y}from"./Link.4e9a6f0f.js";import{_ as b}from"./Badge.4bd69676.js";import{u as v}from"./useConfirmDialog.ba73d887.js";import{f as j,s as _,_ as w}from"./Pay.968f65cd.js";import{$ as k}from"./drop.cce90c26.js";import{g,l as h}from"./useAvatar.7737e550.js";import{u as M}from"./useModalForm.1c23c14e.js";import{b as x,a as C}from"./index.8fc70fb6.js";import{u as S}from"./useSuspense.29183c13.js";import{_ as F}from"./Button.4b020695.js";import"./headlessui.esm.b519f347.js";import"./Dropdown.df5c89e3.js";import"./Th.32cd08d3.js";import"./useIntersectionObserver.7ad3d6a4.js";import"./Dialog.b36041f9.js";import"./Spinner.2e0ab286.js";import"./Input.b03a61c6.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./Select.bf4a4e1e.js";import"./departments.4f88a00d.js";import"./groups.5d62c0cb.js";import"./orders.a1ebe807.js";import"./useOrder.941ce970.js";import"./FormActions.47218f8a.js";const D={class:"flex justify-between mb-3"},E=t("span",null,"Заказ наряд: ",-1),I={class:"flex justify-between mb-3"},O=t("span",null,"Сумма к оплате: ",-1),A={class:"flex justify-between mb-3"},B=t("span",null,"Вид оплаты: ",-1),T={async setup(r){let i,l;const{invoice:p,atMounted:u,typesMapper:d}=P();return[i,l]=e((()=>u())),i=await i,l(),(e,r)=>{var i,l,u,c;return s(),a("div",null,[t("h3",D,[E,t("span",null,"№"+o(n(g)(null==(i=n(p))?void 0:i.order_id)),1)]),t("h3",I,[O,t("span",null,o(null==(l=n(p))?void 0:l.sum)+"₽",1)]),t("h3",A,[B,t("span",null,o(null!=(c=n(d).payments[null==(u=n(p))?void 0:u.payment_type])?c:"_"),1)])])}}},U=x();let W,H;const J=()=>{W=void 0},L=async()=>{const{id:e}=W;if(e){((e={})=>{var s;W.id=null==e?void 0:e.id,W.order_id=null==(s=null==e?void 0:e.order)?void 0:s.id,W.payment_type=null==e?void 0:e.payment_type,W.operation_type=null==e?void 0:e.operation_type,W.sum=null==e?void 0:e.sum})(await k.finance(e)||{})}};function P(e){H||(H=e);return{invoice:W,pay:(e,s)=>{const a=r();a.cleanups.push(J),a.run((()=>{const{render:t}=M({title:"Оплатить",RawForm:T,atSubmit:async()=>{const{success:e,message:a}=await s();try{return{message:a||"что-то пошло не так",success:!0}}finally{e&&U.success("Платеж прошел успешно")}},atClose:()=>a.stop(),atOpen:({id:e})=>{W||(W=i({id:e}))}},{left:"Отменить",right:"Оплатить"});t(e)}))},atMounted:L,clearMemo:J,typesMapper:H}}const R={class:"font-bold"},V={class:"font-bold"},$={async setup(a){let r,i;const{drop:m}=v(),{render:g,types:M,typesMapper:x,finance_color_map:C,payment_types:S}=j(),{state:F,fetchFinances:D,drop:E}=_();let{pay:I,typesMapper:O}=P(x);const A=[{label:"Название",key:"name"},{label:"Сумма (₽)",key:"sum"},{label:"Оплаченная сумма (₽)",key:"paid_sum"},{label:"Тип операции",key:"operation_type"},{label:"Статус",key:"status"},{label:"Дата создания",key:"created_at"}];return[r,i]=e((()=>(async()=>{const{success:e,operation_types:s,payment_types:a}=await k({key:"finances/types"});e&&(x.value={operations:s,payments:a})})())),r=await r,i(),[r,i]=e((()=>D())),r=await r,i(),l((()=>{O=void 0})),(e,a)=>(s(),p(f,{fields:A,items:n(F).raw,onEdit:a[0]||(a[0]=e=>n(g)(e)),onDelete:a[1]||(a[1]=e=>n(m)((()=>n(E)(e)))),noEdit:({status:e})=>"ready"===e},{"td-name":u((({value:e,item:{id:s}})=>[d(y,{onClick:()=>n(g)(s)},{default:u((()=>[c(o(e),1)])),_:2},1032,["onClick"])])),"td-sum":u((({value:e})=>[t("span",R,o(e)+" ₽",1)])),"td-paid_sum":u((({value:e})=>[t("span",V,o(e?`${e} ₽`:"_"),1)])),"td-operation_type":u((({value:e})=>{var s;return[d(b,{point:!0,color:null==(s=n(h)[n(C)[e]])?void 0:s.color},{default:u((()=>[c(o(n(x).operations[e]),1)])),_:2},1032,["color"])]})),"td-status":u((({value:s,item:a})=>[d(w,{id:null==a?void 0:a.id,status:s,cb:e.updateStatus,paymentWrapper:e=>n(I)(a,e)},null,8,["id","status","cb","paymentWrapper"])])),"td-created_at":u((({value:e})=>[c(o(null==e?void 0:e.split(" ")[0]),1)])),_:1},8,["items","noEdit"]))}},q={class:"mb-5"},z=c("Добавить оплату "),G={setup(e){const{route:o}=C(),{cleanUp:r}=_(o.params.id),i=S($),{render:p,cleanUpForm:c}=j(o.params.id);return l((()=>{c(),r()})),(e,r)=>(s(),a("div",null,[t("div",q,[d(F,{color:"blue",onClick:r[0]||(r[0]=()=>n(p)(void 0,n(o).params.id))},{default:u((()=>[d(n(m),{class:"w-5 h-5 mr-1"}),z])),_:1})]),d(n(i))]))}};export{G as default};
