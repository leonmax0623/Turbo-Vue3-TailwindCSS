import{F as e,G as a,c as l,E as s,H as r,I as o,ag as n,S as t,p as d,V as i,A as u,o as m,d as c,e as p,j as v,u as f,J as h,W as b,X as V,h as _,l as y,f as g,a2 as $}from"./vendor.36c281f3.js";import{_ as w}from"./Input.b03a61c6.js";import{_ as k}from"./Select.bf4a4e1e.js";import{_ as C}from"./TextArea.fcc59b75.js";import{a as j}from"./index.8fc70fb6.js";import{$ as M}from"./drop.cce90c26.js";import{s as U,c as x,h as A}from"./useAvatar.7737e550.js";import{d as F}from"./departments.4f88a00d.js";import{u as X}from"./useModalForm.1c23c14e.js";import{_ as B}from"./Button.4b020695.js";import{_ as q}from"./CarsTable.14d70802.js";import{c as I}from"./clients.e20f9038.js";const E=e=>function(a){if(!Array.isArray(a)||0===a.length)return!1;if(void 0!==a.active)return a.invalide=a.active,e(a[a.active]);for(let l=0;l<a.length;l++)if(!e(a[l]))return a.invalide=l,!1;return Reflect.deleteProperty(a,"invalide")||!0},P=E(e.$validator),O=E(a.$validator),R=E((e=>16===e.length));const{current:S,setCurrent:T}=F;let z,D,G,H,J,W;const K={id:"",name:"",surname:"",middle_name:"",gender:"",address:"",passport:"",notes:"",born_at:"",phones:["+7"],emails:[""],department_id:"",cars:[]},L=async e=>{var a,l,s,r;if(!(await W.value.$validate()))return;W.value.$reset();const{data:o,success:n,message:t}=await U.client(z,null,!0);if(!e){if(!n)return;return(null==(l=null==(a=null==o?void 0:o.client)?void 0:a.department)?void 0:l.id)&&T(null==(r=null==(s=null==o?void 0:o.client)?void 0:s.department)?void 0:r.id),H(),n}{const{reset:e,fill:a}=I;try{return{message:t,success:n}}finally{n&&(e(),await a({department_id:S.value}))}}},N=function(e){var a,l,s,r;if("department_id"!==e)return Array.isArray(K[e])?"cars"!==e?Array.isArray(this[e])&&this[e].length?void(z[e]=this[e]):void(z[e]="phones"===e?["+7"]:[""]):void(z[e]=null!=(s=this[e])?s:[]):void(z[e]=null!=(r=this[e])?r:"");z.department_id=null!=(l=null==(a=this.department)?void 0:a.id)?l:S.value},Q=async e=>{if(e)return;let a={};G.value&&D.params.id&&(a=await M.client(D.params.id)),await(async e=>{Object.keys(z).forEach(N,e),z.born_at&&(z.born_at=A(z.born_at))})(a||{})},Y=e=>()=>{if(Array.isArray(z[e])&&z[e].length){if(Reflect.deleteProperty(z[e],"active"),z[e]=z[e].filter((e=>!!e)),!z[e].length)return void(z[e]=[""]);if(W.value[e].$touch(),W.value[e].$error)return;return z[e].push("phones"===e?"+7":""),void W.value[e].$reset()}z[e]=[""]},Z=()=>{z=void 0,D=void 0,G=void 0,H=void 0,J=void 0,W=void 0},ee=a=>{if(z)return;z=r({id:"",name:"",surname:"",middle_name:"",gender:"",address:"",passport:"",notes:"",born_at:"",phones:["+7"],emails:[""],department_id:"",cars:[]});const n=l((()=>({name:{required:s.withMessage("Укажите имя",e)},surname:{required:s.withMessage("Укажите фамилия",e)},emails:{mails:s.withMessage("Укажите верный email",O)},phones:{requiredArr:s.withMessage("Укажите телефон",P),phoned:s.withMessage("Укажите верный телефон",R)},department_id:{required:s.withMessage("Укажите отделение",e)}})));W=o(n,z,{$lazy:!0}),z.department_id=S.value;const{route:t,isThePage:d,back:i}=j("EditClient");[D,G,H]=[t,d,i]};function ae(e){return e?J=(...e)=>{const a=t();a.cleanups.push(Z),a.run((()=>{const s=l((()=>!!z.id)),{render:r}=X({title:l((()=>x.modal[s.value?"update":"create"].client)),RawForm:d(ge,{inModal:!0}),atSubmit:()=>L(!0),atClose:()=>a.stop(),atOpen:()=>ee()});r(...e)}))}:(ee(),n(Z)),{clientFields:z,modalUp:J,isEditClientPage:G,v$:W,saveClient:()=>L(!1),atMountedClientForm:Q,addItem:Y,redirectBack:H,clearMemo:Z}}const le={class:"grid grid-cols-12 gap-6"},se={class:"col-span-12 sm:col-span-4"},re={class:"col-span-12 sm:col-span-4"},oe={class:"col-span-12 sm:col-span-4"},ne={class:"col-span-12 sm:col-span-4"},te={class:"col-span-12 sm:col-span-4 "},de={class:"col-span-12 sm:col-span-4 "},ie={class:"col-span-12 sm:col-span-8"},ue={class:"col-span-12 sm:col-span-12"},me={class:"flex flex-row gap-4 flex-wrap items-center"},ce=y("Ещё"),pe={class:"col-span-12 sm:col-span-12"},ve={class:"flex flex-row gap-4 flex-wrap items-center"},fe=y("Ещё"),he={class:"col-span-12 sm:col-span-12"},be={key:0,class:"col-span-12 sm:col-span-12"},Ve={class:"flex justify-between items-center my-6"},_e=p("span",null,"Автомобили",-1),ye=y("Добавить"),ge={props:{inModal:{type:Boolean}},async setup(e){let a,l;const s=e,{options:r}=F,{clientFields:o,v$:n,atMountedClientForm:t,addItem:d}=ae(s.inModal);[a,l]=i((()=>t(s.inModal))),a=await a,l();const y=d("emails"),j=d("phones"),M=e=>{o.cars=o.cars.filter((({id:a})=>a!=e))};return(a,l)=>{var s,t;const d=u("v-can");return m(),c("div",le,[p("div",se,[v(w,{label:"Фамилия",modelValue:f(o).surname,"onUpdate:modelValue":l[0]||(l[0]=e=>f(o).surname=e),required:!0,error:null==(s=f(n).surname.$errors[0])?void 0:s.$message,onBlured:f(n).surname.$touch},null,8,["modelValue","error","onBlured"])]),p("div",re,[v(w,{label:"Имя",modelValue:f(o).name,"onUpdate:modelValue":l[1]||(l[1]=e=>f(o).name=e),required:!0,error:null==(t=f(n).name.$errors[0])?void 0:t.$message,onBlured:f(n).name.$touch},null,8,["modelValue","error","onBlured"])]),p("div",oe,[v(w,{label:"Отчество",modelValue:f(o).middle_name,"onUpdate:modelValue":l[2]||(l[2]=e=>f(o).middle_name=e)},null,8,["modelValue"])]),p("div",ne,[v(k,{label:"Пол",modelValue:f(o).gender,"onUpdate:modelValue":l[3]||(l[3]=e=>f(o).gender=e),options:[{value:"male",label:"Мужчина"},{value:"female",label:"Женщина"}]},null,8,["modelValue"])]),p("div",te,[v(w,{label:"День рождения",type:"date",modelValue:f(o).born_at,"onUpdate:modelValue":l[4]||(l[4]=e=>f(o).born_at=e)},null,8,["modelValue"])]),p("div",de,[v(w,{label:"Паспорт",mask:"XXXX XXXXXX",modelValue:f(o).passport,"onUpdate:modelValue":l[5]||(l[5]=e=>f(o).passport=e)},null,8,["modelValue"])]),v(d,{ability:"crud departments",class:"col-span-12 sm:col-span-4"},{default:h((()=>{var a;return[v(k,{disabled:e.inModal,label:"Отделение",options:f(r),modelValue:f(o).department_id,"onUpdate:modelValue":l[6]||(l[6]=e=>f(o).department_id=e),required:!0,error:null==(a=f(n).department_id.$errors[0])?void 0:a.$message,onBlured:f(n).department_id.$touch},null,8,["disabled","options","modelValue","error","onBlured"])]})),_:1}),p("div",ie,[v(w,{label:"Адрес",modelValue:f(o).address,"onUpdate:modelValue":l[7]||(l[7]=e=>f(o).address=e)},null,8,["modelValue"])]),p("div",ue,[p("div",me,[(m(!0),c(b,null,V(f(o).phones,((e,a)=>{var l;return m(),c("div",{class:"flex items-center",key:`phones-${a}`},[v(w,{label:`Телефон ${a+1}`,mask:"+7 ### ###-##-##",modelValue:f(o).phones[a],"onUpdate:modelValue":e=>f(o).phones[a]=e,error:f(o).phones.invalide==a?null==(l=f(n).phones.$errors[0])?void 0:l.$message:"",onInput:f(n).phones.$touch,onFocused:e=>f(o).phones.active=a},null,8,["label","modelValue","onUpdate:modelValue","error","onInput","onFocused"]),a>0?(m(),g(B,{key:0,onClick:e=>f(o).phones.splice(a,1),color:"red",class:"ml-2"},{default:h((()=>[v(f($),{class:"w-5 h-5"})])),_:2},1032,["onClick"])):_("",!0)])})),128)),v(B,{onClick:l[8]||(l[8]=()=>f(j)()),type:"secondary"},{default:h((()=>[ce])),_:1})])]),p("div",pe,[p("div",ve,[(m(!0),c(b,null,V(f(o).emails,((e,a)=>{var l;return m(),c("div",{class:"flex items-center",key:`emails-${a}`},[v(w,{label:`Почта ${a+1}`,type:"email",modelValue:f(o).emails[a],"onUpdate:modelValue":e=>f(o).emails[a]=e,error:f(o).emails.invalide==a?null==(l=f(n).emails.$errors[0])?void 0:l.$message:"",onInput:f(n).emails.$touch,onFocused:e=>f(o).emails.active=a},null,8,["label","modelValue","onUpdate:modelValue","error","onInput","onFocused"]),a>0?(m(),g(B,{key:0,onClick:e=>f(o).emails.splice(a,1),color:"red",class:"ml-2"},{default:h((()=>[v(f($),{class:"w-5 h-5"})])),_:2},1032,["onClick"])):_("",!0)])})),128)),v(B,{onClick:l[9]||(l[9]=()=>f(y)()),type:"secondary"},{default:h((()=>[fe])),_:1})])]),p("div",he,[v(C,{label:"Примечания",modelValue:f(o).notes,"onUpdate:modelValue":l[10]||(l[10]=e=>f(o).notes=e)},null,8,["modelValue"])]),f(o).id?(m(),c("div",be,[p("div",Ve,[_e,v(B,{color:"blue",link:{name:"CarForm",query:{client_id:f(o).id}}},{default:h((()=>[ye])),_:1},8,["link"])]),v(q,{cars:f(o).cars,showOwner:!1,onCarDropped:M},null,8,["cars"])])):_("",!0)])}}};export{ge as _,ae as c};
