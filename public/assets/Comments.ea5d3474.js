import{o as e,f as a,j as l,H as s,a as t,c as r,L as o,M as n,r as i,V as d,A as c,d as u,e as m,t as p,W as v,X as f,u as g,J as w,h as y,Z as x,aG as h,l as b,k}from"./vendor.36c281f3.js";import{_}from"./Button.4b020695.js";import{_ as M}from"./TextArea.fcc59b75.js";import{$ as V}from"./drop.cce90c26.js";import{s as j,u as C,m as A,n as L}from"./useAvatar.7737e550.js";import{b as $,d as P}from"./index.8fc70fb6.js";import{_ as B}from"./Avatar.4eeca634.js";import{_ as E}from"./Spinner.2e0ab286.js";import"./ExclamationCircleIcon.22c0ccb9.js";function H(s,t){return e(),a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z","clip-rule":"evenodd"})])}function z(s,t){return e(),a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z","clip-rule":"evenodd"})])}function G(s,t){return e(),a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})])}const S=$(),T=s({raw:[],pages:100,page:1,pending:!1});var W={state:t(T),reset:()=>{T.raw=[],T.pages=100,T.page=1},load:async(e,a)=>{const l=`comments/${e}/${a}`;T.raw=await V[l]()},sort:e=>{T.raw.sort(e)},fill:async(e,a)=>{var l,s,t;if(T.pending)return;if(T.page>T.pages)return;T.pending=!0;const r=`comments/${e}/${a}`,o=await V({key:r,params:{page:T.page}});T.raw=T.raw.concat(null!=(l=null==o?void 0:o.comments)?l:[]),T.pages=null!=(t=null==(s=null==o?void 0:o.meta)?void 0:s.last_page)?t:100,T.page+=1,T.pending=!1},save:async(e,a,l)=>{const s=`comments/${e}/${a}`,{success:t}=await j[s]({description:l});return!t&&S.danger("Не удалось сохранить комментарий"),t},addComment:e=>{const a=T.raw.findIndex((({id:a})=>(null==e?void 0:e.id)==a));a<0?T.raw.push(e):T.raw[a]=e},count:r((()=>T.raw.length))};o("data-v-70f6d148");const I={"aria-labelledby":"notes-title"},O={class:"bg-white shadow sm:rounded-lg sm:overflow-hidden"},U={class:"divide-y divide-gray-200"},F={class:"px-4 py-5 sm:px-6"},D={id:"notes-title",class:"text-lg font-medium text-gray-900"},R={class:"px-4 py-6 sm:px-6"},J={role:"list",class:"space-y-8"},Q={class:"flex space-x-3"},X={class:"flex-shrink-0"},Z={class:"flex-grow"},q={class:"text-sm"},K={class:"mt-1 text-sm text-gray-700"},N={class:"mt-1 flex flex-wrap"},Y={class:"column flex flex-col mx-1"},ee={key:0,class:"comment-file-preview rounded shadow-md",controls:"",autoplay:""},ae=["src"],le=["href"],se=["src"],te={class:"column flex flex-col mx-1"},re={key:0,class:"comment-file-preview rounded shadow-md",controls:"",autoplay:""},oe=["src"],ne=["href"],ie=["src"],de={class:"column flex flex-col mx-1"},ce={key:0,class:"comment-file-preview rounded shadow-md",controls:"",autoplay:""},ue=["src"],me=["href"],pe=["src"],ve={class:"column flex flex-col mx-1"},fe={key:0,class:"comment-file-preview rounded shadow-md",controls:"",autoplay:""},ge=["src"],we=["href"],ye=["src"],xe={class:"mt-2 text-sm space-x-2"},he={class:"text-gray-500 font-medium"},be={class:"bg-gray-50 px-4 py-6 sm:px-6"},ke={class:"flex space-x-3"},_e={class:"flex-shrink-0"},Me={class:"min-w-0 flex-1"},Ve=m("label",{for:"comment",class:"sr-only"},"Комментарий",-1),je={key:0,class:"border shadow rounded-md my-1 p-2 flex flex-wrap gap-2"},Ce={key:0,class:"upload-preview rounded shadow-md",autoplay:"",muted:""},Ae=["src"],Le=["src"],$e=["onClick"],Pe={class:"mt-3 flex items-center justify-between flex-wrap"},Be={class:"flex gap-9 mb-2"},Ee={for:"attach-file-upload"},He={for:"camera-video"},ze={for:"camera-image"},Ge={class:"mb-2 group inline-flex items-start text-sm space-x-2 text-gray-500 hover:text-gray-900"},Se=m("small",null,"Только текст, HTML запрещён",-1),Te={key:1};n();const We={props:{title:String,model:String,id:[String,Object],disabled:{type:Boolean,default:!1}},emits:["comment"],async setup(s,{emit:t}){let r,o;const n=s,V=$(),{load:j,save:S,state:T,addComment:We}=W,{user:Ie}=P(),Oe=i(""),Ue=i([]),Fe=i(!1),De=["WEBM","MPG","MP2","MPEG","MPE","MPV","OGG","MP4","M4P","M4V","AVI","WMV","MOV","QT","FLV","SWF","AVCHD"],Re=e=>{var a;if("string"==typeof e){const a=[...e.split(".")].pop();return De.includes(a.toUpperCase())}return null==(a=null==e?void 0:e.type)?void 0:a.startsWith("video/")},Je=e=>window.URL.createObjectURL(e),Qe=e=>{Ue.value=[...e.target.files],console.log(Ue.value)};[r,o]=d((()=>(async()=>{n.model&&n.id&&await j(n.model,g(n.id))})())),r=await r,o();const Xe=e=>{e.currentTarget.classList.add("current-preview")},Ze=e=>{e.currentTarget.classList.remove("current-preview")},qe=(e,a=0,l=4)=>e.filter(((e,s)=>s%l===a));return(s,r)=>{var o;const i=c("router-link");return e(),u("section",I,[m("div",O,[m("div",U,[m("div",F,[m("h2",D,p(null!=(o=n.title)?o:"Комментарии / Заметки"),1)]),m("div",R,[m("ul",J,[(e(!0),u(v,null,f(g(T).raw,(a=>(e(),u("li",{key:a.id},[m("div",Q,[m("div",X,[l(B,{image:a.user.avatar},null,8,["image"])]),m("div",Z,[m("div",q,[l(i,{class:"font-medium text-gray-900",to:{name:"EditEmployer",params:{id:a.user.id}}},{default:w((()=>{var e,l;return[b(p(null!=(e=a.user.name)?e:"")+" "+p(null!=(l=a.user.middle_name)?l:""),1)]})),_:2},1032,["to"])]),m("div",K,[m("p",null,p(a.description),1)]),m("div",N,[m("div",Y,[(e(!0),u(v,null,f(qe(a.files,0),(({id:a,url:l,file_name:s})=>(e(),u("span",{key:a,class:"my-1"},[Re(s)?(e(),u("video",ee,[m("source",{src:l,type:"video/mp4"},null,8,ae)])):(e(),u("a",{key:1,href:l,target:"_blank"},[m("img",{class:"comment-file-preview rounded shadow-md",src:l},null,8,se)],8,le))])))),128))]),m("div",te,[(e(!0),u(v,null,f(qe(a.files,1),(({id:a,url:l})=>(e(),u("span",{key:a,class:"my-1"},[Re(s.file_name)?(e(),u("video",re,[m("source",{src:l,type:"video/mp4"},null,8,oe)])):(e(),u("a",{key:1,href:l,target:"_blank"},[m("img",{class:"comment-file-preview rounded shadow-md",src:l},null,8,ie)],8,ne))])))),128))]),m("div",de,[(e(!0),u(v,null,f(qe(a.files,2),(({id:a,url:l})=>(e(),u("span",{key:a,class:"my-1"},[Re(s.file_name)?(e(),u("video",ce,[m("source",{src:l,type:"video/mp4"},null,8,ue)])):(e(),u("a",{key:1,href:l,target:"_blank"},[m("img",{class:"comment-file-preview rounded shadow-md",src:l},null,8,pe)],8,me))])))),128))]),m("div",ve,[(e(!0),u(v,null,f(qe(a.files,3),(({id:a,url:l})=>(e(),u("span",{key:a,class:"my-1"},[Re(s.file_name)?(e(),u("video",fe,[m("source",{src:l,type:"video/mp4"},null,8,ge)])):(e(),u("a",{key:1,href:l,target:"_blank"},[m("img",{class:"comment-file-preview rounded shadow-md",src:l},null,8,ye)],8,we))])))),128))])]),m("div",xe,[m("span",he,p(g(A)(g(L)(a.created_at))),1)])])])])))),128))])])]),m("div",be,[m("div",ke,[m("div",_e,[l(B,{image:g(Ie).avatar},null,8,["image"])]),m("div",Me,[m("div",null,[Ve,l(M,{disabled:n.disabled,placeholder:"Текст вашего комментария...",rows:"3",modelValue:Oe.value,"onUpdate:modelValue":r[0]||(r[0]=e=>Oe.value=e)},null,8,["disabled","modelValue"])]),l(x,{name:"slide-fade"},{default:w((()=>[Ue.value.length?(e(),u("div",je,[(e(!0),u(v,null,f(Ue.value,((a,s)=>(e(),u("span",{onMouseenter:Xe,onMouseleave:Ze,key:s,class:"relative mx-1 my-1"},[Re(a)?(e(),u("video",Ce,[m("source",{src:Je(a),type:"video/mp4"},null,8,Ae)])):(e(),u("img",{key:1,class:"upload-preview rounded shadow-md",src:Je(a)},null,8,Le)),m("span",{class:"remover bg-white rounded-full absolute -top-3 -right-3 shadow cursor-pointer",onClick:()=>(e=>{Ue.value=Ue.value.filter((a=>e!=a))})(a)},[l(g(k),{class:"w-6 text-gray-600"})],8,$e)],32)))),128))])):y("",!0)])),_:1}),m("div",Pe,[m("div",Be,[m("span",null,[m("label",Ee,[l(g(z),{class:"h-7 transform -rotate-45 text-blue-500 hover:text-blue-600 cursor-pointer"})]),m("input",{class:"hidden",id:"attach-file-upload",type:"file",multiple:"",onChange:Qe,accept:"image/*, video/*"},null,32)]),m("label",He,[l(g(G),{class:"h-7 text-blue-500 hover:text-blue-600 cursor-pointer"}),m("input",{onChange:Qe,class:"hidden",id:"camera-video",type:"file",capture:"",accept:"video/*"},null,32)]),m("label",ze,[l(g(H),{class:"h-7 text-blue-500 hover:text-blue-600 cursor-pointer"}),m("input",{onChange:Qe,class:"hidden",id:"camera-image",type:"file",capture:"",accept:"image/*"},null,32)])]),m("span",Ge,[l(g(h),{class:"flex-shrink-0 h-5 w-5 text-gray-400 group-hover:text-gray-500","aria-hidden":"true"}),Se]),l(_,{class:"h-9 w-28 flex justify-center",disabled:n.disabled||Fe.value,color:"blue",onClick:r[1]||(r[1]=()=>(async e=>{var a,l;if(!Fe.value)try{const s=null!=(l=null==(a=Ue.value)?void 0:a.length)?l:0;if(!Oe.value&&!s)return;const r=g(n.id);if(!r)return;const o=new FormData;for(let e=0;e<s;e++)o.append("files[]",Ue.value[e]);o.append("description",e||"_"),Fe.value=!0;const{message:i,success:d,data:c}=await C(`comments/${n.model}/${r}`,o);d?(Oe.value="",Ue.value=[],t("comment",e),We(c.comment),V.success("Комментарий сохранен")):V.danger(i||"Не удалось сохранить комментарий")}finally{Fe.value=!1}})(Oe.value))},{default:w((()=>[Fe.value?(e(),a(E,{key:0,class:"h-1"})):(e(),u("span",Te,"Отправить"))])),_:1},8,["disabled"])])])])])])])}},__scopeId:"data-v-70f6d148"};export{We as default};
