import{V as e,A as a,o as r,d as t,j as s,u as o,J as n,c as d,E as i,F as l,S as m,H as u,I as c,ag as p,f,l as v,t as j,aO as b,aP as _,a1 as g,h as y}from"./vendor.36c281f3.js";import{_ as h}from"./Office.55bfbecd.js";import{_ as w}from"./Button.4b020695.js";import{u as $}from"./useSuspense.29183c13.js";import{_ as k}from"./Link.4e9a6f0f.js";import{u as B}from"./useConfirmDialog.ba73d887.js";import{s as S}from"./index.d9cbb9ba.js";import{_ as V}from"./Table.ec42ea9a.js";import{_ as M}from"./Input.b03a61c6.js";import{_ as q}from"./Select.bf4a4e1e.js";import{d as O}from"./departments.4f88a00d.js";import{c as x,s as A}from"./useAvatar.7737e550.js";import{u as C}from"./useModalForm.1c23c14e.js";import{b as D}from"./index.8fc70fb6.js";import{$ as F}from"./drop.cce90c26.js";import"./headlessui.esm.b519f347.js";import"./Avatar.4eeca634.js";import"./Dropdown.df5c89e3.js";import"./NavBar.2f63176e.js";import"./meta.48f5205a.js";import"./Spinner.2e0ab286.js";import"./Dialog.b36041f9.js";import"./Th.32cd08d3.js";import"./useIntersectionObserver.7ad3d6a4.js";import"./ExclamationCircleIcon.22c0ccb9.js";import"./FormActions.47218f8a.js";const I={async setup(d){let i,l;const{options:m,load:u}=O,{storage:c,atMounted:p,v$:f}=J();return[i,l]=e((()=>Promise.all([p()]))),i=await i,l(),(e,d)=>{var i;const l=a("v-can");return r(),t("div",null,[s(M,{label:"Название",modelValue:o(c).name,"onUpdate:modelValue":d[0]||(d[0]=e=>o(c).name=e),required:!0,error:null==(i=o(f).name.$errors[0])?void 0:i.$message,onBlured:o(f).name.$touch,class:"mb-3"},null,8,["modelValue","error","onBlured"]),s(l,{ability:"crud departments"},{default:n((()=>{var e;return[s(q,{label:"Oтделение",modelValue:o(c).department_id,"onUpdate:modelValue":d[1]||(d[1]=e=>o(c).department_id=e),required:!0,options:o(m),error:null==(e=o(f).department_id.$errors[0])?void 0:e.$message,onBlured:o(f).department_id.$touch},null,8,["modelValue","options","error","onBlured"])]})),_:1})])}}};const{current:E}=O,{add:P}=S,T=D();let R,U;const z=async()=>{const{id:e}=R;if(e){const a=await F.storage(e);((e={})=>{var a;R.id=e.id,R.name=e.name,R.city_id=null==(a=e.city)?void 0:a.id})(null!=a?a:{})}},H=async()=>{var e;if(!(await U.value.$validate()))return;U.value.$reset();const{message:a,success:r,data:t}=await A.storage(R);try{return{message:a,success:r}}finally{r&&((null==(e=t.storage.department)?void 0:e.id)==E.value&&P(t.storage),T.success(a))}};function J(){return{storage:R,atMounted:z,render:(...e)=>{const a=m(!0);a.run((()=>{const r=d((()=>!!(null==R?void 0:R.id))),{render:t}=C({title:d((()=>x.modal[r.value?"update":"create"].storage)),RawForm:I,atSubmit:H,atClose:()=>a.stop(),atOpen:e=>{R=u({id:null!=e?e:"",name:"",department_id:E.value}),U=c(d((()=>({name:{required:i.withMessage("Укажите имя",l)},department_id:{required:i.withMessage("выберите отделение",l)}}))),R,{$lazy:!0})}});t(...e),p((()=>{R=void 0}))}))},v$:U,current:E}}const L={async setup(a){let t,d;const{current:i}=O,l=[{label:"Название",key:"name"},{label:"Дата создания",key:"created_at"}],{drop:m}=B(),{render:u}=J(),{storages:c,fill:p,reset:b,drop:_}=S,g=async(e=!1)=>{e&&b(),await p({department_id:i.value})};return[t,d]=e((()=>g(!0))),t=await t,d(),(e,a)=>(r(),f(V,{onBottomTouched:a[0]||(a[0]=()=>g()),fields:l,items:o(c),onDelete:a[1]||(a[1]=e=>o(m)((()=>o(_)(e)))),onEdit:a[2]||(a[2]=e=>o(u)(e))},{"td-name":n((({value:e,item:{id:a,name:r}})=>[s(k,{href:{name:"Storage",params:{id:a,name:r}}},{default:n((()=>[v(j(e),1)])),_:2},1032,["href"])])),"td-created_at":n((({value:e})=>[v(j(e),1)])),_:1},8,["items"]))}},N=v("Запрошенные запчасти "),G=v("Производители "),K=v("Создать "),Q={setup(e){const{current:a}=O,{render:t}=J(),d=$(L);return(e,i)=>(r(),f(h,{title:"Все склады"},{actions:n((()=>[s(w,{type:"secondary",link:{name:"StorageRequests"}},{default:n((()=>[s(o(b),{class:"w-5 h-5 mr-1"}),N])),_:1}),s(w,{type:"secondary",link:{name:"Producers"}},{default:n((()=>[s(o(_),{class:"w-5 h-5 mr-1"}),G])),_:1}),s(w,{color:"blue",onClick:i[0]||(i[0]=()=>o(t)())},{default:n((()=>[s(o(g),{class:"w-5 h-5 mr-1"}),K])),_:1})])),default:n((()=>[o(a)?(r(),f(o(d),{loadingMsg:"получаем складов...",key:`dep-${o(a)}`})):y("",!0)])),_:1}))}};export{Q as default};
