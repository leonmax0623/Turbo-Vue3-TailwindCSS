import{c as a,E as s,F as r,S as t,H as e,I as o,ag as i}from"./vendor.36c281f3.js";import{d,a as u}from"./index.8fc70fb6.js";import{r as c,s as l}from"./useAvatar.7737e550.js";import{$ as n}from"./drop.cce90c26.js";import{s as p,a as v}from"./storage-requests.df03da5b.js";import{u as m}from"./useConfirmDialog.ba73d887.js";const{dropProduct:f}=p,{select:g,drop:_}=v,{user:h}=d(),{drop:w}=m();let y;var P=()=>t().run((()=>{const{route:t,isThePage:d,back:p}=u("EditStorage"),v=async a=>{try{p()}finally{a&&g(a)}},{avatar:m,isUploadingAvatar:P,isValideAvatarFileSize:j,log:A,setAvatar:b,updateAvatar:$,defaults:E}=c();y||(y=e({id:"",name:"",place:"",count:"",input_sum:"",output_sum:"",description:"",sku:"",producer_id:"",storage_id:"",user_id:""}));const{rules:F}={rules:a((()=>({name:{required:s.withMessage("Заполните поле",r)},count:{required:s.withMessage("Заполните поле",r)}})))},S=o(F,y,{$lazy:!0}),k=function(a){var s,r,e;if(a.includes("_id"))return"storage_id"===a?void(y.storage_id=t.params.id):"user_id"===a?void(y.user_id=h.value.id):void(y[a]=null!=(r=null==(s=this[a.replace("_id","")])?void 0:s.id)?r:"");y[a]=null!=(e=this[a])?e:""};return i((()=>{y=void 0})),{isValideAvatarFileSize:j,log:A,avatar:m,product:y,isEditProductPage:d,v$:S,saveProduct:async()=>{var a,s;let r=await S.value.$validate();if(r&&(r=j.value),!r)return;S.value.$reset();let{data:t,success:e}=await l.product(y,null,!0);e&&(e=await $(`/products/${null==(a=null==t?void 0:t.product)?void 0:a.id}/photo`,"photo"),e&&await v(null==(s=null==t?void 0:t.product)?void 0:s.id))},atMountedProductForm:async()=>{const a=d.value&&t.params.product&&await n.product(t.params.product);await(async a=>{b(a,"photo"),Object.keys(y).forEach(k,a)})(a||{})},isUploadingAvatar:P,previousPage:v,dropProduct:(a=t.params.product,s=!1)=>w((async()=>{const{success:r,message:t}=await _(a);return s&&f(a),r&&d.value&&p(),r&&g(),{success:r,message:t}})),defaults:E}}));export{P as f};
